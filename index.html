<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chizel - Turning Screen Time To Skill Time!</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Comic+Neue:wght@400;700&display=swap">
    <style>
        :root {
            --primary: #4A90E2;
            --secondary: #50E3C2;
            --accent: #F8E71C;
            --dark: #1A2E40;
            --light: #E0F7FF;
            --success: #7ED321;
            --warning: #F5A623;
            --danger: #D0021B;
            --mummy-color: #4A90E2;
            --kid-color: #F5A623;
            --space-purple: #9013FE;
            --space-blue: #1A2E40;
            --neon-pink: #FF10F0;
            --neon-green: #39FF14;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: var(--space-blue);
            color: var(--light);
            height: 100vh;
            overflow: hidden;
            perspective: 1000px;
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        /* Animated Space Background */
        .space-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, var(--space-blue) 0%, #000000 100%);
            z-index: -2;
            overflow: hidden;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: -1;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle var(--duration, 5s) infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        .planet {
            position: absolute;
            border-radius: 50%;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
            animation: float var(--float-duration, 120s) infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0) translateX(0) rotate(0deg); }
            100% { transform: translateY(-1000px) translateX(500px) rotate(360deg); }
        }

        .comet {
            position: absolute;
            width: 6px;
            height: 6px;
            background: linear-gradient(to right, 
                rgba(255, 255, 255, 0) 0%, 
                rgba(255, 255, 255, 0.8) 50%, 
                rgba(255, 255, 255, 0) 100%);
            border-radius: 50%;
            filter: blur(1px);
            animation: comet var(--comet-duration, 10s) linear infinite;
            opacity: 0;
        }

        @keyframes comet {
            0% { 
                transform: translateX(0) translateY(0);
                opacity: 1;
            }
            100% { 
                transform: translateX(1000px) translateY(500px);
                opacity: 0;
            }
        }

        /* Nebula Animation */
        .nebula {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(106, 13, 173, 0.3) 0%, 
                rgba(48, 63, 159, 0.2) 50%, 
                transparent 70%);
            filter: blur(30px);
            animation: pulse 15s infinite alternate;
            z-index: -1;
        }

        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.3; }
            100% { transform: scale(1.2); opacity: 0.6; }
        }

        /* Main Game UI */
        .header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            z-index: 10;
        }

        .logo {
            height: 50px;
            filter: drop-shadow(0 0 10px var(--secondary));
        }

        .game-stats {
            display: flex;
            gap: 20px;
        }

        /* XP Bar */
        .xp-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .xp-label {
            font-family: 'Fredoka', sans-serif;
            font-size: 14px;
            color: var(--secondary);
            text-shadow: 0 0 5px var(--secondary);
        }

        .xp-bar {
            width: 200px;
            height: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--secondary);
            box-shadow: 0 0 10px var(--secondary);
        }

        .xp-progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, 
                var(--primary) 0%, 
                var(--secondary) 50%, 
                var(--neon-pink) 100%);
            border-radius: 8px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .xp-progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                rgba(255, 255, 255, 0.3) 50%, 
                rgba(255, 255, 255, 0.1) 100%);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .xp-value {
            font-family: 'Fredoka', sans-serif;
            font-size: 16px;
            color: white;
            text-shadow: 0 0 5px white;
        }

        /* Level Display */
        .level-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .level-label {
            font-family: 'Fredoka', sans-serif;
            font-size: 14px;
            color: var(--accent);
            text-shadow: 0 0 5px var(--accent);
        }

        .level-value {
            font-family: 'Fredoka', sans-serif;
            font-size: 16px;
            color: white;
            text-shadow: 0 0 5px white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 3px 10px;
            border-radius: 20px;
            border: 2px solid var(--accent);
            box-shadow: 0 0 10px var(--accent);
        }

        /* Characters - Fixed positioning and animations */
        .character-container {
            position: absolute;
            bottom: 10%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 5%;
            z-index: 5;
            left: 0;
            right: 0;
        }

        .character {
            position: relative;
            width: 25%;
            max-width: 300px;
            bottom: 0;
            margin: 0;
            transition: transform 0.3s ease;
        }

        .character:hover {
            transform: translateY(-10px);
        }

        .character-image {
            position: relative;
            width: 100%;
            height: auto;
        }

        .character-image img {
            width: 100%;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 10px 20px rgba(74, 144, 226, 0.5));
            position: relative;
        }

        /* Speech Bubbles - Improved positioning */
        .speech-bubble {
            position: absolute;
            padding: 15px;
            border-radius: 20px;
            max-width: 300px;
            font-size: 18px;
            line-height: 1.4;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            transform: scale(0);
            transform-origin: bottom;
            z-index: 6;
            font-family: 'Comic Neue', cursive;
        }

        .speech-bubble.visible {
            transform: scale(1);
        }

        .left-bubble {
            background-color: var(--dark);
            color: var(--light);
            left: 25%;
            bottom: 100%;
            margin-bottom: 20px;
            border: 2px solid var(--mummy-color);
            box-shadow: 0 0 15px var(--mummy-color);
        }

        .left-bubble::after {
            content: '';
            position: absolute;
            left: 20px;
            top: 100%;
            width: 0;
            height: 0;
            border: 15px solid transparent;
            border-top-color: var(--dark);
            border-bottom: 0;
            border-left: 0;
            margin-left: -7.5px;
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.3));
        }

        .right-bubble {
            background-color: var(--kid-color);
            color: var(--dark);
            right: 25%;
            bottom: 100%;
            margin-bottom: 20px;
            border: 2px solid var(--kid-color);
            box-shadow: 0 0 15px var(--kid-color);
        }

        .right-bubble::after {
            content: '';
            position: absolute;
            right: 20px;
            top: 100%;
            width: 0;
            height: 0;
            border: 15px solid transparent;
            border-top-color: var(--kid-color);
            border-bottom: 0;
            border-right: 0;
            margin-right: -7.5px;
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.3));
        }

        .bubble-content {
            min-height: 40px;
        }

        .typing-indicator {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 5px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: var(--light);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
            30% { transform: translateY(-5px); opacity: 1; }
        }

        /* Options Container - Simplified layout */
        .options-container {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            width: 80%;
            max-width: 800px;
            padding: 20px;
            background-color: rgba(26, 46, 64, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(80, 227, 194, 0.2);
            border: 2px solid var(--secondary);
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .options-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .option-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            font-family: 'Fredoka', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            box-shadow: 0 5px 15px rgba(80, 227, 194, 0.3);
            flex: 1 1 200px;
            max-width: 300px;
        }

        .option-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(80, 227, 194, 0.5);
        }

        .option-btn:active {
            transform: translateY(1px);
        }

        /* Task Container - Simplified UI */
        .task-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            background: linear-gradient(135deg, rgba(26, 46, 64, 0.95) 0%, rgba(26, 46, 64, 0.95) 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--secondary);
            z-index: 20;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s ease;
            backdrop-filter: blur(10px);
        }

        .task-container.visible {
            opacity: 1;
            pointer-events: all;
        }

        .task-header {
            font-family: 'Fredoka', sans-serif;
            font-size: 22px;
            color: var(--secondary);
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 0 10px var(--secondary);
            letter-spacing: 1px;
        }

        .task-content {
            margin-bottom: 25px;
            font-size: 18px;
            line-height: 1.6;
        }

        .task-submit {
            display: block;
            margin: 25px auto 0;
            padding: 12px 35px;
            background: linear-gradient(135deg, var(--success) 0%, var(--neon-green) 100%);
            color: var(--dark);
            border: none;
            border-radius: 50px;
            font-family: 'Fredoka', sans-serif;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(57, 255, 20, 0.4);
        }

        .task-submit:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(57, 255, 20, 0.6);
        }

        .task-submit:active {
            transform: translateY(1px);
        }

        .task-submit.hidden {
            display: none;
        }

        /* Cloud Thinking Box - Improved styling */
        .thinking-box {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 600px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 50px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            z-index: 15;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s ease;
            clip-path: polygon(
                0% 20%, 10% 0%, 20% 10%, 30% 0%, 
                40% 10%, 50% 0%, 60% 10%, 70% 0%, 
                80% 10%, 90% 0%, 100% 20%, 
                90% 30%, 100% 40%, 90% 50%, 
                100% 60%, 90% 70%, 100% 80%, 
                80% 100%, 70% 90%, 60% 100%, 
                50% 90%, 40% 100%, 30% 90%, 
                20% 100%, 10% 90%, 0% 80%, 
                10% 70%, 0% 60%, 10% 50%, 
                0% 40%, 10% 30%
            );
            animation: float 6s ease-in-out infinite;
        }

        .thinking-box.visible {
            opacity: 1;
            pointer-events: all;
        }

        .thinking-content {
            color: var(--dark);
            font-size: 18px;
            line-height: 1.6;
            text-align: center;
            font-family: 'Comic Neue', cursive;
        }

        /* Brain Teaser Styles */
        .brain-teaser {
            text-align: center;
        }

        .teaser-question {
            font-size: 20px;
            margin-bottom: 25px;
            font-weight: bold;
            color: var(--light);
        }

        .teaser-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .teaser-option {
            padding: 15px;
            background-color: rgba(74, 144, 226, 0.1);
            border: 2px solid var(--primary);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light);
            font-size: 16px;
        }

        .teaser-option:hover {
            background-color: rgba(74, 144, 226, 0.3);
            transform: translateX(5px);
        }

        .teaser-option.selected {
            background-color: var(--primary);
            color: white;
            font-weight: bold;
            box-shadow: 0 0 15px var(--primary);
            transform: scale(1.05);
        }

        /* Quick Challenge Styles */
        .quick-challenge {
            text-align: center;
        }

        .challenge-instruction {
            font-size: 18px;
            margin-bottom: 25px;
            color: var(--light);
        }

        .drag-drop-area {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            gap: 20px;
        }

        .drag-items, .drop-target {
            width: 48%;
            min-height: 200px;
            border: 2px dashed var(--secondary);
            border-radius: 15px;
            padding: 20px;
            background-color: rgba(80, 227, 194, 0.05);
            transition: all 0.3s ease;
        }

        .drag-item {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: grab;
            font-size: 16px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .drag-item:last-child {
            margin-bottom: 0;
        }

        .drag-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(80, 227, 194, 0.4);
        }

        .drag-item:active {
            cursor: grabbing;
        }

        .drop-target.highlight {
            border-color: var(--success);
            background-color: rgba(126, 211, 33, 0.1);
            box-shadow: 0 0 20px rgba(126, 211, 33, 0.3);
        }

        /* Learn a Fact Styles */
        .learn-fact {
            text-align: center;
        }

        .fact-content {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 25px;
            color: var(--light);
            background-color: rgba(144, 19, 254, 0.2);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid var(--neon-pink);
        }

        .fact-image {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--secondary);
        }

        .fact-question {
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--light);
        }

        .fact-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .fact-option {
            padding: 15px;
            background-color: rgba(245, 166, 35, 0.1);
            border: 2px solid var(--kid-color);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light);
            font-size: 16px;
        }

        .fact-option:hover {
            background-color: rgba(245, 166, 35, 0.3);
            transform: translateX(5px);
        }

        .fact-option.selected {
            background-color: var(--kid-color);
            color: var(--dark);
            font-weight: bold;
            box-shadow: 0 0 15px var(--kid-color);
            transform: scale(1.05);
        }

        /* Coding Challenge Styles */
        .coding-challenge {
            text-align: center;
        }

        .code-instruction {
            font-size: 18px;
            margin-bottom: 20px;
            color: var(--light);
        }

        .code-editor {
            width: 100%;
            height: 200px;
            background-color: #1E1E2E;
            border: 2px solid var(--secondary);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: var(--light);
            margin-bottom: 20px;
            resize: none;
            line-height: 1.5;
        }

        .code-output {
            width: 100%;
            min-height: 100px;
            background-color: #1E1E2E;
            border: 2px solid var(--secondary);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: var(--light);
            margin-bottom: 20px;
            text-align: left;
            white-space: pre-wrap;
        }

        /* Memory Game Styles - Fixed layout */
        .memory-game {
            text-align: center;
        }

        .memory-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 500px;
        }

        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
            position: relative;
        }

        .memory-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--secondary);
        }

        .memory-card.flipped {
            background: var(--dark);
            transform: rotateY(180deg);
        }

        .memory-card.matched {
            background: var(--success);
            transform: rotateY(180deg);
            cursor: default;
            pointer-events: none;
        }

        /* Achievement Badges */
        .achievement-badge {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            z-index: 30;
            opacity: 0;
            transition: all 0.5s ease;
            max-width: 400px;
            border: 4px solid var(--accent);
        }

        .achievement-badge.visible {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .badge-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent);
        }

        .badge-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 20px;
            margin-bottom: 15px;
            color: white;
        }

        .badge-desc {
            font-size: 16px;
            margin-bottom: 20px;
            color: white;
        }

        .badge-close {
            padding: 10px 25px;
            background: var(--accent);
            border: none;
            border-radius: 50px;
            font-family: 'Fredoka', sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .badge-close:hover {
            transform: scale(1.05);
        }

        /* Confetti Effect */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0;
            z-index: 100;
            animation: confetti-fall 5s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Daily Reward Button */
        .daily-reward-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: rgba(80, 227, 194, 0.2);
            border: 2px solid var(--secondary);
            border-radius: 50px;
            color: white;
            font-family: 'Fredoka', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .daily-reward-btn:hover {
            background: rgba(80, 227, 194, 0.4);
            transform: translateX(-50%) scale(1.05);
        }

        /* Story Progress Tracker */
        .story-tracker {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 5px;
            z-index: 10;
        }

        .story-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(80, 227, 194, 0.3);
            transition: all 0.3s ease;
        }

        .story-dot.active {
            background-color: var(--secondary);
            transform: scale(1.3);
            box-shadow: 0 0 10px var(--secondary);
        }

        /* Mummy AI Assistant */
        .mummy-assistant {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 90%;
            max-width: 600px;
            background: linear-gradient(135deg, rgba(26, 46, 64, 0.95) 0%, rgba(26, 46, 64, 0.95) 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--secondary);
            z-index: 30;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s ease;
            backdrop-filter: blur(10px);
        }

        .mummy-assistant.visible {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            pointer-events: all;
        }

        .mummy-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .mummy-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            color: white;
        }

        .mummy-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 18px;
            color: var(--secondary);
            text-shadow: 0 0 10px var(--secondary);
        }

        .mummy-message {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--light);
        }

        .mummy-input {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--secondary);
            background-color: rgba(0, 0, 0, 0.3);
            color: white;
            font-family: 'Comic Neue', cursive;
            font-size: 16px;
            margin-bottom: 15px;
            resize: none;
        }

        .mummy-controls {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .mummy-btn {
            padding: 10px 20px;
            border-radius: 50px;
            border: none;
            font-family: 'Fredoka', sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mummy-submit {
            background: linear-gradient(135deg, var(--success) 0%, var(--neon-green) 100%);
            color: var(--dark);
        }

        .mummy-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(57, 255, 20, 0.5);
        }

        .mummy-close {
            background: rgba(208, 2, 27, 0.2);
            color: var(--light);
            border: 2px solid var(--danger);
        }

        .mummy-close:hover {
            background: rgba(208, 2, 27, 0.4);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(208, 2, 27, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .character {
                width: 35%;
            }
            
            .left-bubble, .right-bubble {
                max-width: 250px;
                font-size: 16px;
            }
            
            .options-container {
                width: 90%;
                padding: 15px;
            }
            
            .option-btn {
                font-size: 14px;
                padding: 10px 15px;
            }
            
            .task-container {
                padding: 20px;
            }

            .task-header {
                font-size: 18px;
            }

            .teaser-question, .fact-question {
                font-size: 18px;
            }

            .drag-drop-area {
                flex-direction: column;
            }

            .drag-items, .drop-target {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .character {
                width: 40%;
                bottom: 5%;
            }
            
            .left-bubble {
                left: 15%;
                bottom: 100%;
            }
            
            .right-bubble {
                right: 15%;
                bottom: 100%;
            }
            
            .options-container {
                bottom: 5%;
            }
            
            .xp-bar {
                width: 150px;
            }

            .header {
                flex-direction: column;
                gap: 10px;
                align-items: center;
            }

            .game-stats {
                width: 100%;
                justify-content: space-between;
            }

            .memory-board {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Animation Classes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .bounce {
            animation: bounce 0.5s ease infinite;
        }

        /* Power Up Effects */
        .power-up-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(80, 227, 194, 0.3) 0%, transparent 70%);
            z-index: 25;
            opacity: 0;
            pointer-events: none;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Animated Space Background -->
        <div class="space-background">
            <div class="stars" id="stars"></div>
            <div class="nebula" style="top: 20%; left: 10%;"></div>
            <div class="nebula" style="top: 60%; left: 70%;"></div>
            <div class="planet" style="width: 200px; height: 200px; background: radial-gradient(circle at 30% 30%, #9013FE, #1A2E40); top: 15%; left: 70%; --float-duration: 300s;"></div>
            <div class="planet" style="width: 150px; height: 150px; background: radial-gradient(circle at 30% 30%, #F5A623, #D0021B); top: 70%; left: 10%; --float-duration: 250s;"></div>
            <div class="comet" style="top: 10%; left: 5%; --comet-duration: 15s;"></div>
            <div class="comet" style="top: 30%; left: 80%; --comet-duration: 20s;"></div>
        </div>

        <!-- Game Header -->
        <div class="header">
            <img src="assets/logo.png" alt="Chizel Logo" class="logo">
            <div class="game-stats">
                <div class="xp-container">
                    <div class="xp-label">XP:</div>
                    <div class="xp-bar">
                        <div class="xp-progress"></div>
                    </div>
                    <div class="xp-value">0</div>
                </div>
                <div class="level-container">
                    <div class="level-label">LEVEL:</div>
                    <div class="level-value">1</div>
                </div>
            </div>
        </div>

        <!-- Characters - Fixed positioning -->
        <div class="character-container">
            <div class="character left">
                <div class="character-image">
                    <img src="assets/mummy.png" alt="Mummy the Learning Guide">
                </div>
                <!-- Speech bubble for mother -->
                <div class="speech-bubble left-bubble" id="mother-speech">
                    <div class="bubble-content"></div>
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>
            <div class="character right">
                <div class="character-image">
                    <img src="assets/kid.png" alt="You">
                </div>
                <!-- Speech bubble for kid -->
                <div class="speech-bubble right-bubble" id="kid-speech">
                    <div class="bubble-content"></div>
                </div>
            </div>
        </div>

        <!-- Options Container -->
        <div class="options-container"></div>

        <!-- Task Container -->
        <div class="task-container">
            <div class="task-header"></div>
            <div class="task-content"></div>
            <button class="task-submit hidden">Submit</button>
        </div>

        <!-- Cloud Thinking Box -->
        <div class="thinking-box">
            <div class="thinking-content"></div>
        </div>

        <!-- Story Progress Tracker -->
        <div class="story-tracker" id="story-tracker"></div>

        <!-- Daily Reward Button -->
        <button class="daily-reward-btn" id="daily-reward-btn">
            <span>🎁</span> Daily Reward
        </button>

        <!-- Achievement Badge -->
        <div class="achievement-badge" id="achievement-badge">
            <div class="badge-icon">🏆</div>
            <div class="badge-title">ACHIEVEMENT UNLOCKED!</div>
            <div class="badge-desc">You earned the 'Quick Learner' badge!</div>
            <button class="badge-close">Awesome!</button>
        </div>

        <!-- Power Up Effect -->
        <div class="power-up-effect" id="power-up-effect"></div>

        <!-- Mummy AI Assistant -->
        <div class="mummy-assistant" id="mummy-assistant">
            <div class="mummy-header">
                <div class="mummy-avatar">M</div>
                <div class="mummy-title">MUMMY HELPER</div>
            </div>
            <div class="mummy-message" id="mummy-message">How can I help you with your learning today?</div>
            <textarea class="mummy-input" id="mummy-input" placeholder="Ask me anything about learning..."></textarea>
            <div class="mummy-controls">
                <button class="mummy-btn mummy-close" id="mummy-close">Close</button>
                <button class="mummy-btn mummy-submit" id="mummy-submit">Ask</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            currentStep: 0,
            xp: localStorage.getItem('chizelXP') ? parseInt(localStorage.getItem('chizelXP')) : 0,
            level: localStorage.getItem('chizelLevel') ? parseInt(localStorage.getItem('chizelLevel')) : 1,
            completedTasks: JSON.parse(localStorage.getItem('chizelCompletedTasks')) || [],
            achievements: JSON.parse(localStorage.getItem('chizelAchievements')) || [],
            currentTask: null,
            taskCompleted: false,
            storyProgress: 0,
            mummyKnowledge: {},
            lastLoginDate: localStorage.getItem('chizelLastLogin') || null,
            audioEnabled: false
        };

        // DOM Elements
        const elements = {
            leftCharacter: document.querySelector('.character.left'),
            rightCharacter: document.querySelector('.character.right'),
            motherSpeech: document.getElementById('mother-speech'),
            kidSpeech: document.getElementById('kid-speech'),
            motherBubbleContent: document.querySelector('#mother-speech .bubble-content'),
            kidBubbleContent: document.querySelector('#kid-speech .bubble-content'),
            optionsContainer: document.querySelector('.options-container'),
            xpBar: document.querySelector('.xp-progress'),
            xpValue: document.querySelector('.xp-value'),
            levelValue: document.querySelector('.level-value'),
            taskContainer: document.querySelector('.task-container'),
            taskContent: document.querySelector('.task-content'),
            taskSubmit: document.querySelector('.task-submit'),
            taskHeader: document.querySelector('.task-header'),
            typingIndicator: document.querySelector('.typing-indicator'),
            thinkingBox: document.querySelector('.thinking-box'),
            thinkingContent: document.querySelector('.thinking-content'),
            starsContainer: document.getElementById('stars'),
            storyTracker: document.getElementById('story-tracker'),
            dailyRewardBtn: document.getElementById('daily-reward-btn'),
            achievementBadge: document.getElementById('achievement-badge'),
            powerUpEffect: document.getElementById('power-up-effect'),
            mummyAssistant: document.getElementById('mummy-assistant'),
            mummyMessage: document.getElementById('mummy-message'),
            mummyInput: document.getElementById('mummy-input'),
            mummySubmit: document.getElementById('mummy-submit'),
            mummyClose: document.getElementById('mummy-close')
        };

        // Create stars for background
        function createStars() {
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = `${Math.random() * 3 + 1}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.opacity = Math.random();
                star.style.animationDelay = `${Math.random() * 5}s`;
                star.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
                elements.starsContainer.appendChild(star);
            }
        }

        // Extended Story Script with Brainrot Battle Theme
        const storyScript = [
            // Introduction
            {
                speaker: 'mummy',
                message: "👋 Hi there! Welcome to CHIZEL - the coolest learning app in the universe! I'm Mummy, your learning guide!",
                options: [
                    { text: "What's CHIZEL?", nextStep: 1, xp: 5 },
                    { text: "How does it work?", nextStep: 2, xp: 5 }
                ],
                thinking: "CHIZEL is a revolutionary app that turns learning into an exciting adventure..."
            },
            {
                speaker: 'mummy',
                message: "CHIZEL is a special app that helps kids learn while having fun! It turns math, science, and reading into exciting games!",
                options: [
                    { text: "That sounds cool!", nextStep: 3, xp: 5 },
                    { text: "What can I learn?", nextStep: 4, xp: 5 }
                ],
                thinking: "With CHIZEL, kids don't even realize they're learning because they're having so much fun..."
            },
            {
                speaker: 'mummy',
                message: "CHIZEL makes learning an adventure! You'll earn XP for every question you answer, and level up your skills!",
                options: [
                    { text: "I want to try!", nextStep: 5, xp: 10 },
                    { text: "Tell me more!", nextStep: 6, xp: 5 }
                ],
                thinking: "The more you learn, the more XP you earn. Parents love seeing their kids progress with CHIZEL!"
            },
            {
                speaker: 'mummy',
                message: "Great attitude! CHIZEL has games for math, reading, science, and even coding! All designed by teachers to be super fun!",
                options: [
                    { text: "Let's play!", nextStep: 7, xp: 5 },
                    { text: "How does it help me?", nextStep: 8, xp: 5 }
                ],
                thinking: "CHIZEL adapts to each child's level, making sure they're always challenged but never frustrated..."
            },
            {
                speaker: 'mummy',
                message: "CHIZEL teaches everything from ABCs to multiplication! It helps with focus, memory, and problem-solving - skills you'll use forever!",
                options: [
                    { text: "I'm ready to learn!", nextStep: 7, xp: 10 },
                    { text: "Show me a game!", nextStep: 9, xp: 5 }
                ],
                thinking: "Studies show kids using CHIZEL improve their test scores by 30% compared to traditional learning..."
            },
            {
                speaker: 'mummy',
                message: "That's the spirit! Your first mission has three fun challenges: Math Puzzle, Memory Game, and Word Challenge!",
                options: [],
                action: 'startTasks',
                thinking: "Mission parameters set. Remember: in CHIZEL, we make learning as fun as playing your favorite game!"
            },
            {
                speaker: 'mummy',
                message: "CHIZEL grows with you! As you level up, the games get more exciting and you unlock new learning adventures!",
                options: [
                    { text: "Got it!", nextStep: 5, xp: 5 },
                    { text: "What are levels?", nextStep: 10, xp: 5 }
                ],
                thinking: "Parents can track progress through our secure dashboard, seeing exactly what their child is mastering..."
            },
            {
                speaker: 'mummy',
                message: "Let's play! *ding* This game will help you practice addition while saving cute aliens! Ready?",
                options: [
                    { text: "Yes, let's go!", nextStep: 5, xp: 10 },
                    { text: "How do I play?", nextStep: 11, xp: 5 }
                ],
                thinking: "Game-based learning increases engagement by 70% compared to traditional methods..."
            },
            {
                speaker: 'mummy',
                message: "At level 5 you unlock Math Blaster! Level 10 gets Story Builder! The ultimate Science Explorer requires level 20!",
                options: [
                    { text: "I'll level up fast!", nextStep: 5, xp: 10 },
                    { text: "Tell me more", nextStep: 12, xp: 5 }
                ],
                thinking: "Pro tip: Playing daily gives bonus XP! CHIZEL's algorithm ensures optimal learning retention..."
            },
            {
                speaker: 'mummy',
                message: "Here's a secret: CHIZEL games strengthen your brain muscles! You'll get better at focusing, remembering, and solving problems!",
                options: [
                    { text: "My brain is ready!", nextStep: 5, xp: 10 },
                    { text: "How does that work?", nextStep: 13, xp: 5 }
                ],
                thinking: "Neuroscience shows that game-based learning creates stronger neural pathways..."
            },
            {
                speaker: 'mummy',
                message: "Levels show your progress! Each level means you've learned new skills. Parents can see all your achievements!",
                options: [
                    { text: "I want to level up!", nextStep: 5, xp: 10 },
                    { text: "Can parents see?", nextStep: 14, xp: 5 }
                ],
                thinking: "The parent dashboard shows learning progress, time spent, and skills mastered..."
            },
            {
                speaker: 'mummy',
                message: "Exactly! CHIZEL is kid-safe with no ads. Parents get reports showing what you're learning and how you're improving!",
                options: [
                    { text: "That's awesome!", nextStep: 5, xp: 15 },
                    { text: "What about safety?", nextStep: 15, xp: 5 }
                ],
                thinking: "CHIZEL is COPPA compliant with strict privacy protections for all children..."
            },
            {
                speaker: 'mummy',
                message: "CHIZEL is super safe! No strangers can contact you, no inappropriate content, and parents control everything!",
                options: [
                    { text: "Great! Let's play!", nextStep: 5, xp: 15 },
                    { text: "What else makes CHIZEL special?", nextStep: 16, xp: 5 }
                ],
                thinking: "Unlike other apps, CHIZEL focuses on real learning, not just mindless tapping..."
            },
            {
                speaker: 'mummy',
                message: "CHIZEL is different because: 1) Real teachers designed it 2) It adapts to your level 3) It makes learning FUN!",
                options: [
                    { text: "I love it!", nextStep: 5, xp: 20 },
                    { text: "Let's play now!", nextStep: 5, xp: 10 }
                ],
                thinking: "The secret sauce is combining educational expertise with game design magic..."
            },
            {
                speaker: 'mummy',
                message: "One more thing! CHIZEL gives daily rewards for learning, with special weekend bonuses!",
                options: [
                    { text: "I want rewards!", nextStep: 5, xp: 15 },
                    { text: "How do I earn them?", nextStep: 17, xp: 5 }
                ],
                thinking: "Daily engagement creates consistent learning habits that last a lifetime..."
            },
            {
                speaker: 'mummy',
                message: "Just play every day! You'll get XP bonuses, collectible stars, and unlock special avatars!",
                options: [
                    { text: "I'll play daily!", nextStep: 5, xp: 20 },
                    { text: "Let's start now!", nextStep: 5, xp: 10 }
                ],
                thinking: "Daily users show 3x the learning gains compared to occasional players..."
            },
            // After tasks are completed
            {
                speaker: 'mummy',
                message: "⭐ AMAZING JOB! ⭐ You've earned 150 XP and learned new skills! Parents will be so proud!",
                options: [],
                action: 'showFinalMessage',
                thinking: "Learning analytics show excellent progress... skills mastered... ready for next challenge..."
            }
        ];

        // Initialize Mummy's knowledge base
        function initMummyKnowledge() {
            gameState.mummyKnowledge = {
                "chizel": "CHIZEL is a revolutionary learning app that makes education fun through games. It teaches math, reading, science and more while keeping kids engaged and motivated.",
                "learning": "Learning with CHIZEL strengthens your brain! It helps with focus, memory, and problem-solving - skills you'll use in school and life!",
                "xp": "XP (Experience Points) measure your learning progress. Earn XP by completing challenges. More XP = higher levels and cooler rewards!",
                "levels": "Levels show your progress. Each level means you've mastered new skills. Parents can see your level in their dashboard.",
                "parents": "CHIZEL has a special parent dashboard showing learning progress, time spent, and skills mastered. Parents love seeing their kids learn!",
                "safety": "CHIZEL is 100% kid-safe with no ads or strangers. It's COPPA compliant with strict privacy protections for all children.",
                "games": "CHIZEL games include: Math Blaster, Word Explorer, Science Adventure, Memory Master, and Coding Quest - all designed by teachers!",
                "rewards": "Earn daily rewards for learning! Special bonuses on weekends! Collect stars and unlock fun avatars!",
                "help": "I'm here to help with: learning tips, game instructions, XP explanations, and parent information. Ask me anything!",
                "features": "What makes CHIZEL special: 1) Designed by teachers 2) Adapts to your level 3) Makes learning FUN 4) Parent dashboard 5) Kid-safe environment"
            };
        }

        // Extended Task Data with Learning Focus
        const tasks = [
            {
                id: 'brain-teaser',
                title: "MATH QUEST: Save the Aliens!",
                type: "brain-teaser",
                question: "To rescue the aliens, solve this: If 3 aliens need 5 cookies each, and you have 20 cookies, how many aliens can you feed?",
                options: ["4 aliens", "6 aliens", "5 aliens", "3 aliens"],
                correctAnswer: 0,
                xp: 50,
                thinking: "Great math practice! 20 cookies ÷ 5 per alien = 4 aliens. You're helping them so much!"
            },
            {
                id: 'memory-game',
                title: "MEMORY MASTER: Match the Planets",
                type: "memory-game",
                pairs: ["🌍", "🌕", "🪐", "☀️", "🚀", "👽", "🔭", "⭐"],
                xp: 50,
                thinking: "Matching games strengthen your memory - an important skill for school and life!"
            },
            {
                id: 'coding-challenge',
                title: "CODE QUEST: Fix the Rocket",
                type: "coding-challenge",
                instruction: "Debug this rocket launch code by fixing the errors:",
                code: `function launchRocket() {\n  if fuel > 100\n    return "Blast Off!"\n  else\n    console.log("Need more fuel!")\n}`,
                correctAnswer: `function launchRocket() {\n  if (fuel > 100) {\n    return "Blast Off!";\n  } else {\n    console.log("Need more fuel!");\n  }\n}`,
                xp: 50,
                thinking: "Coding teaches logical thinking - a super valuable skill for your future!"
            },
            {
                id: 'quick-challenge',
                title: "WORD EXPLORER: Sentence Builder",
                type: "quick-challenge",
                instruction: "Drag the words to build a proper sentence:",
                items: ["jumps", "The", "dog", "happy"],
                correctOrder: ["The", "happy", "dog", "jumps"],
                xp: 50,
                thinking: "Building sentences helps with reading and writing skills. Great job!"
            },
            {
                id: 'learn-fact',
                title: "SCIENCE DISCOVERY: Amazing Animals",
                type: "learn-fact",
                fact: "Did you know? A group of flamingos is called a 'flamboyance'! These pink birds get their color from the shrimp they eat.",
                question: "What gives flamingos their pink color?",
                options: ["The sun", "The shrimp they eat", "Pink feathers", "The water"],
                correctAnswer: 1,
                xp: 50,
                thinking: "Learning fun facts makes science exciting and helps you remember important concepts!"
            },
            {
                id: 'math-puzzle',
                title: "NUMBER NINJA: Treasure Hunt",
                type: "brain-teaser",
                question: "To find the treasure, solve this: If you have 12 gold coins and find 8 more, but lose 5, how many do you have?",
                options: ["15 coins", "20 coins", "10 coins", "25 coins"],
                correctAnswer: 0,
                xp: 50,
                thinking: "12 + 8 - 5 = 15. Math is everywhere, even in treasure hunts!"
            },
            {
                id: 'word-game',
                title: "LETTER LEGEND: Find the Vowels",
                type: "quick-challenge",
                instruction: "Drag all the vowels to the target area:",
                items: ["A", "B", "E", "C", "I", "D", "O", "F"],
                correctOrder: ["A", "E", "I", "O"],
                xp: 50,
                thinking: "Knowing vowels helps with reading and spelling. You're doing great!"
            }
        ];

        // Achievements Data
        const achievements = [
            {
                id: 'quick-learner',
                title: "Quick Learner",
                description: "Completed 3 challenges quickly!",
                icon: "🏎️",
                xpBonus: 20
            },
            {
                id: 'daily-star',
                title: "Daily Star",
                description: "Played 3 days in a row!",
                icon: "🌟",
                xpBonus: 30
            },
            {
                id: 'math-whiz',
                title: "Math Whiz",
                description: "Solved 10 math problems!",
                icon: "➕",
                xpBonus: 50
            },
            {
                id: 'word-wizard',
                title: "Word Wizard",
                description: "Completed 5 word challenges!",
                icon: "🔠",
                xpBonus: 50
            },
            {
                id: 'science-star',
                title: "Science Star",
                description: "Learned 10 science facts!",
                icon: "🔬",
                xpBonus: 50
            }
        ];

        // Initialize the game
        function initGame() {
            createStars();
            initMummyKnowledge();
            updateXPDisplay();
            updateLevel();
            showStoryStep(0);
            createStoryTracker();
            checkDailyReward();
            
            // Set up task submit button
            elements.taskSubmit.addEventListener('click', checkTaskAnswer);
            
            // Set up daily reward button
            elements.dailyRewardBtn.addEventListener('click', giveDailyReward);
            
            // Set up Mummy assistant
            elements.mummyClose.addEventListener('click', () => toggleMummyAssistant(false));
            elements.mummySubmit.addEventListener('click', handleMummyQuery);
            elements.mummyInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleMummyQuery();
            });
            
            // Show characters with animation
            setTimeout(() => {
                elements.leftCharacter.classList.add('visible');
                elements.rightCharacter.classList.add('visible');
            }, 500);
            
            // Check for achievements
            checkAchievements();
        }

        // Check for daily reward eligibility
        function checkDailyReward() {
            const today = new Date().toDateString();
            if (gameState.lastLoginDate !== today) {
                elements.dailyRewardBtn.style.display = 'flex';
            } else {
                elements.dailyRewardBtn.style.display = 'none';
            }
        }

        // Give daily reward
        function giveDailyReward() {
            const today = new Date().toDateString();
            gameState.lastLoginDate = today;
            localStorage.setItem('chizelLastLogin', today);
            
            // Weekend bonus
            const isWeekend = [0, 6].includes(new Date().getDay());
            const rewardAmount = isWeekend ? 50 : 30;
            
            addXP(rewardAmount);
            showAchievement(`Daily Reward: ${rewardAmount} XP!`, isWeekend ? "🎉" : "🎁");
            
            elements.dailyRewardBtn.style.display = 'none';
        }

        // Create story progress tracker
        function createStoryTracker() {
            elements.storyTracker.innerHTML = '';
            for (let i = 0; i < storyScript.length; i++) {
                const dot = document.createElement('div');
                dot.className = 'story-dot';
                if (i === gameState.currentStep) {
                    dot.classList.add('active');
                }
                elements.storyTracker.appendChild(dot);
            }
        }

        // Update story tracker
        function updateStoryTracker() {
            const dots = document.querySelectorAll('.story-dot');
            dots.forEach((dot, index) => {
                if (index === gameState.currentStep) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        // Show story step
        function showStoryStep(stepIndex) {
            gameState.currentStep = stepIndex;
            const step = storyScript[stepIndex];
            
            if (!step) return;
            
            // Update story progress
            gameState.storyProgress = (stepIndex / storyScript.length) * 100;
            
            // Clear options
            elements.optionsContainer.innerHTML = '';
            elements.optionsContainer.classList.remove('visible');
            
            // Hide kid bubble if it's Mummy's turn to speak
            elements.kidSpeech.classList.remove('visible');
            
            if (step.speaker === 'mummy') {
                // Show thinking box if available
                if (step.thinking) {
                    elements.thinkingContent.textContent = step.thinking;
                    elements.thinkingBox.classList.add('visible');
                }
                
                // Show typing indicator
                elements.typingIndicator.style.display = 'flex';
                
                // Type out the message
                typeMessage(step.message, elements.motherBubbleContent, () => {
                    // Hide typing indicator when done
                    elements.typingIndicator.style.display = 'none';
                    
                    // Show bubble
                    elements.motherSpeech.classList.add('visible');
                    
                    // Hide thinking box after a delay
                    if (step.thinking) {
                        setTimeout(() => {
                            elements.thinkingBox.classList.remove('visible');
                        }, 2000);
                    }
                    
                    // If there's an action, perform it
                    if (step.action) {
                        performAction(step.action);
                    }
                    
                    // Show options if they exist
                    if (step.options && step.options.length > 0) {
                        showOptions(step.options);
                    }
                });
            } else {
                // For user responses
                elements.kidBubbleContent.textContent = step.message;
                elements.kidSpeech.classList.add('visible');
                
                // Move to next step after delay
                setTimeout(() => {
                    showStoryStep(step.nextStep);
                }, 1500);
            }
            
            // Update story tracker
            updateStoryTracker();
        }

        // Type message with typing animation
        function typeMessage(message, element, callback) {
            let i = 0;
            element.textContent = '';
            
            function typing() {
                if (i < message.length) {
                    element.textContent += message.charAt(i);
                    i++;
                    setTimeout(typing, 30);
                } else if (callback) {
                    callback();
                }
            }
            
            typing();
        }

        // Show response options
        function showOptions(options) {
            elements.optionsContainer.innerHTML = '';
            
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option.text;
                
                button.addEventListener('click', () => {
                    // Show user's response
                    showUserResponse(option.text);
                    
                    // Add XP if specified
                    if (option.xp) {
                        addXP(option.xp);
                    }
                    
                    // Move to next step after delay
                    setTimeout(() => {
                        if (option.nextStep !== undefined) {
                            showStoryStep(option.nextStep);
                        }
                    }, 1500);
                });
                
                elements.optionsContainer.appendChild(button);
            });
            
            elements.optionsContainer.classList.add('visible');
        }

        // Show user response in bubble
        function showUserResponse(message) {
            elements.kidBubbleContent.textContent = message;
            elements.kidSpeech.classList.add('visible');
            elements.optionsContainer.classList.remove('visible');
            elements.motherSpeech.classList.remove('visible');
        }

        // Perform special action
        function performAction(action) {
            switch (action) {
                case 'startTasks':
                    startTasks();
                    break;
                case 'showFinalMessage':
                    showFinalMessage();
                    break;
            }
        }

        // Start tasks
        function startTasks() {
            // Reset completed tasks
            gameState.completedTasks = [];
            gameState.taskCompleted = false;
            
            // Show first task
            showTask(0);
        }

        // Show task
        function showTask(taskIndex) {
            if (taskIndex >= tasks.length) {
                // All tasks completed
                showStoryStep(storyScript.length - 1); // Show final message
                return;
            }
            
            const task = tasks[taskIndex];
            gameState.currentTask = task;
            
            // Set task header
            elements.taskHeader.textContent = task.title;
            
            // Clear previous task content
            elements.taskContent.innerHTML = '';
            elements.taskSubmit.classList.add('hidden');
            
            // Show thinking box if available
            if (task.thinking) {
                elements.thinkingContent.textContent = task.thinking;
                elements.thinkingBox.classList.add('visible');
            }
            
            // Create task based on type
            switch (task.type) {
                case 'brain-teaser':
                    createBrainTeaser(task);
                    break;
                case 'memory-game':
                    createMemoryGame(task);
                    break;
                case 'coding-challenge':
                    createCodingChallenge(task);
                    break;
                case 'quick-challenge':
                    createQuickChallenge(task);
                    break;
                case 'learn-fact':
                    createLearnFact(task);
                    break;
            }
            
            // Show task container
            elements.taskContainer.classList.add('visible');
        }

        // Create brain teaser task
        function createBrainTeaser(task) {
            const container = document.createElement('div');
            container.className = 'brain-teaser';
            
            const question = document.createElement('div');
            question.className = 'teaser-question';
            question.textContent = task.question;
            container.appendChild(question);
            
            const options = document.createElement('div');
            options.className = 'teaser-options';
            
            task.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'teaser-option';
                optionElement.textContent = option;
                
                optionElement.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.teaser-option').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    optionElement.classList.add('selected');
                    
                    // Store selected answer
                    gameState.currentTask.selectedAnswer = index;
                    
                    // Show submit button
                    elements.taskSubmit.classList.remove('hidden');
                });
                
                options.appendChild(optionElement);
            });
            
            container.appendChild(options);
            elements.taskContent.appendChild(container);
        }

        // Create memory game task
        function createMemoryGame(task) {
            const container = document.createElement('div');
            container.className = 'memory-game';
            
            const instruction = document.createElement('div');
            instruction.className = 'challenge-instruction';
            instruction.textContent = "Match the pairs to strengthen your memory!";
            container.appendChild(instruction);
            
            // Duplicate and shuffle the pairs
            const cards = [...task.pairs, ...task.pairs];
            shuffleArray(cards);
            
            const board = document.createElement('div');
            board.className = 'memory-board';
            
            // Track flipped cards
            let flippedCards = [];
            let matchedPairs = 0;
            
            cards.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.index = index;
                card.dataset.symbol = symbol;
                
                card.addEventListener('click', () => {
                    // Don't allow flipping if already flipped or matched
                    if (card.classList.contains('flipped') || 
                        card.classList.contains('matched') ||
                        flippedCards.length >= 2) {
                        return;
                    }
                    
                    // Flip the card
                    card.classList.add('flipped');
                    card.textContent = symbol;
                    flippedCards.push(card);
                    
                    // Check for match when two cards are flipped
                    if (flippedCards.length === 2) {
                        if (flippedCards[0].dataset.symbol === flippedCards[1].dataset.symbol) {
                            // Match found
                            flippedCards.forEach(c => {
                                c.classList.add('matched');
                                c.classList.remove('flipped');
                            });
                            matchedPairs++;
                            
                            // Clear flipped cards array
                            flippedCards = [];
                            
                            // Check if all pairs are matched
                            if (matchedPairs === task.pairs.length) {
                                gameState.currentTask.completed = true;
                                elements.taskSubmit.classList.remove('hidden');
                            }
                        } else {
                            // No match - flip back after delay
                            setTimeout(() => {
                                flippedCards.forEach(c => {
                                    c.classList.remove('flipped');
                                    c.textContent = '';
                                });
                                flippedCards = [];
                            }, 1000);
                        }
                    }
                });
                
                board.appendChild(card);
            });
            
            container.appendChild(board);
            elements.taskContent.appendChild(container);
        }

        // Create coding challenge task
        function createCodingChallenge(task) {
            const container = document.createElement('div');
            container.className = 'coding-challenge';
            
            const instruction = document.createElement('div');
            instruction.className = 'code-instruction';
            instruction.textContent = task.instruction;
            container.appendChild(instruction);
            
            const editor = document.createElement('textarea');
            editor.className = 'code-editor';
            editor.textContent = task.code;
            container.appendChild(editor);
            
            const output = document.createElement('div');
            output.className = 'code-output';
            output.textContent = "Debug the code above to see the output here...";
            container.appendChild(output);
            
            const runBtn = document.createElement('button');
            runBtn.className = 'task-submit';
            runBtn.textContent = "Run Code";
            runBtn.addEventListener('click', () => {
                try {
                    // In a real app, you'd use a proper code evaluation method
                    if (editor.value.trim() === task.correctAnswer) {
                        output.textContent = "Rocket launched successfully!\nOutput: Blast Off!";
                        output.style.color = "var(--success)";
                        gameState.currentTask.completed = true;
                        elements.taskSubmit.classList.remove('hidden');
                    } else {
                        output.textContent = "Error: Rocket unstable! Check your syntax.";
                        output.style.color = "var(--danger)";
                    }
                } catch (e) {
                    output.textContent = "Error: " + e.message;
                    output.style.color = "var(--danger)";
                }
            });
            
            container.appendChild(runBtn);
            elements.taskContent.appendChild(container);
        }

        // Create quick challenge task
        function createQuickChallenge(task) {
            const container = document.createElement('div');
            container.className = 'quick-challenge';
            
            const instruction = document.createElement('div');
            instruction.className = 'challenge-instruction';
            instruction.textContent = task.instruction;
            container.appendChild(instruction);
            
            const dragDropArea = document.createElement('div');
            dragDropArea.className = 'drag-drop-area';
            
            // Drag items (shuffled)
            const shuffledItems = [...task.items];
            shuffleArray(shuffledItems);
            
            const dragItems = document.createElement('div');
            dragItems.className = 'drag-items';
            
            shuffledItems.forEach(item => {
                const dragItem = document.createElement('div');
                dragItem.className = 'drag-item';
                dragItem.textContent = item;
                dragItem.draggable = true;
                
                dragItem.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', item);
                });
                
                dragItems.appendChild(dragItem);
            });
            
            // Drop targets
            const dropTargets = document.createElement('div');
            dropTargets.className = 'drop-targets';
            
            for (let i = 0; i < task.items.length; i++) {
                const dropTarget = document.createElement('div');
                dropTarget.className = 'drop-target';
                dropTarget.dataset.expected = task.correctOrder[i];
                dropTarget.textContent = `Position ${i + 1}`;
                
                dropTarget.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropTarget.classList.add('highlight');
                });
                
                dropTarget.addEventListener('dragleave', () => {
                    dropTarget.classList.remove('highlight');
                });
                
                dropTarget.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropTarget.classList.remove('highlight');
                    
                    const item = e.dataTransfer.getData('text/plain');
                    dropTarget.textContent = item;
                    dropTarget.dataset.value = item;
                    
                    // Check if all positions are filled
                    checkQuickChallengeCompletion();
                });
                
                dropTargets.appendChild(dropTarget);
            }
            
            dragDropArea.appendChild(dragItems);
            dragDropArea.appendChild(dropTargets);
            container.appendChild(dragDropArea);
            elements.taskContent.appendChild(container);
            
            function checkQuickChallengeCompletion() {
                const targets = document.querySelectorAll('.drop-target');
                let allFilled = true;
                let correct = true;
                
                targets.forEach(target => {
                    if (!target.dataset.value) {
                        allFilled = false;
                    } else if (target.dataset.value !== target.dataset.expected) {
                        correct = false;
                    }
                });
                
                if (allFilled) {
                    if (correct) {
                        gameState.currentTask.completed = true;
                        elements.taskSubmit.classList.remove('hidden');
                    } else {
                        // Show error message
                        const errorMsg = document.createElement('div');
                        errorMsg.style.color = "var(--danger)";
                        errorMsg.style.textAlign = "center";
                        errorMsg.style.marginTop = "15px";
                        errorMsg.textContent = "Not quite right! Try again.";
                        elements.taskContent.appendChild(errorMsg);
                    }
                }
            }
        }

        // Create learn a fact task
        function createLearnFact(task) {
            const container = document.createElement('div');
            container.className = 'learn-fact';
            
            const fact = document.createElement('div');
            fact.className = 'fact-content';
            fact.textContent = task.fact;
            container.appendChild(fact);
            
            const question = document.createElement('div');
            question.className = 'fact-question';
            question.textContent = task.question;
            container.appendChild(question);
            
            const options = document.createElement('div');
            options.className = 'fact-options';
            
            task.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'fact-option';
                optionElement.textContent = option;
                
                optionElement.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.fact-option').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    optionElement.classList.add('selected');
                    
                    // Store selected answer
                    gameState.currentTask.selectedAnswer = index;
                    
                    // Show submit button
                    elements.taskSubmit.classList.remove('hidden');
                });
                
                options.appendChild(optionElement);
            });
            
            container.appendChild(options);
            elements.taskContent.appendChild(container);
        }

        // Check task answer
        function checkTaskAnswer() {
            const task = gameState.currentTask;
            let isCorrect = false;
            
            // Check answer based on task type
            switch (task.type) {
                case 'brain-teaser':
                case 'learn-fact':
                    isCorrect = (task.selectedAnswer === task.correctAnswer);
                    break;
                case 'memory-game':
                case 'coding-challenge':
                case 'quick-challenge':
                    isCorrect = task.completed;
                    break;
            }
            
            if (isCorrect) {
                // Add XP
                addXP(task.xp);
                
                // Mark task as completed
                gameState.completedTasks.push(task.id);
                gameState.taskCompleted = true;
                
                // Show success message
                elements.taskContent.innerHTML = `
                    <div style="text-align: center;">
                        <h3 style="color: var(--success);">GREAT JOB! 🎉</h3>
                        <p>You earned ${task.xp} XP!</p>
                        <p>Your learning power increased by ${Math.floor(task.xp/2)}%!</p>
                        <button class="option-btn" style="margin-top: 20px;" id="next-task-btn">Next Challenge</button>
                    </div>
                `;
                
                // Add confetti effect
                createConfetti();
                
                // Show power up effect
                showPowerUpEffect();
                
                // Set up next task button
                document.getElementById('next-task-btn').addEventListener('click', () => {
                    elements.taskContainer.classList.remove('visible');
                    elements.thinkingBox.classList.remove('visible');
                    showTask(gameState.completedTasks.length);
                });
                
                // Check for achievements
                checkAchievements();
            } else {
                // Show try again message
                const errorMsg = document.createElement('div');
                errorMsg.style.textAlign = "center";
                errorMsg.style.marginTop = "20px";
                errorMsg.style.color = "var(--danger)";
                errorMsg.innerHTML = `
                    <p>Not quite right! Try again - you can do it!</p>
                    <p>Remember: Mistakes help us learn!</p>
                `;
                elements.taskContent.appendChild(errorMsg);
            }
        }

        // Show final message
        function showFinalMessage() {
            elements.taskHeader.textContent = "LEARNING COMPLETE!";
            elements.taskContent.innerHTML = `
                <div style="text-align: center;">
                    <h3 style="color: var(--success);">You're becoming a learning superstar!</h3>
                    <p style="font-size: 1.2em; margin: 20px 0;">Your skills improved by ${Math.floor(gameState.xp/6)}%!</p>
                    <p>Keep playing to unlock more learning adventures!</p>
                    <button class="option-btn" style="margin-top: 20px;" id="restart-btn">Play Again</button>
                    <button class="option-btn" style="margin-top: 10px; background: var(--mummy-color);" id="mummy-btn">Ask MUMMY</button>
                </div>
            `;
            
            elements.taskContainer.classList.add('visible');
            
            // Add confetti effect
            createConfetti();
            
            // Set up restart button
            document.getElementById('restart-btn').addEventListener('click', () => {
                elements.taskContainer.classList.remove('visible');
                showStoryStep(0);
            });
            
            // Set up Mummy button
            document.getElementById('mummy-btn').addEventListener('click', () => {
                toggleMummyAssistant(true);
            });
        }

        // Add XP
        function addXP(amount) {
            gameState.xp += amount;
            updateXPDisplay();
            checkLevelUp();
            localStorage.setItem('chizelXP', gameState.xp.toString());
        }

        // Update XP display
        function updateXPDisplay() {
            elements.xpValue.textContent = gameState.xp;
            
            // Calculate XP percentage for current level
            const xpForNextLevel = gameState.level * 100;
            const xpInLevel = gameState.xp - ((gameState.level - 1) * 100);
            const xpPercentage = Math.min(100, (xpInLevel / xpForNextLevel) * 100);
            
            elements.xpBar.style.width = `${xpPercentage}%`;
        }

        // Check for level up
        function checkLevelUp() {
            const neededXP = gameState.level * 100;
            if (gameState.xp >= neededXP) {
                gameState.level++;
                updateLevel();
                showAchievement(`Level ${gameState.level} Unlocked!`, "⬆️");
            }
        }

        // Update level display
        function updateLevel() {
            elements.levelValue.textContent = gameState.level;
            localStorage.setItem('chizelLevel', gameState.level.toString());
        }

        // Create confetti effect
        function createConfetti() {
            const colors = ['#4A90E2', '#50E3C2', '#F8E71C', '#FF10F0', '#39FF14'];
            
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 10 + 5}px`;
                confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                
                document.body.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // Show power up effect
        function showPowerUpEffect() {
            elements.powerUpEffect.style.opacity = '1';
            
            setTimeout(() => {
                elements.powerUpEffect.style.opacity = '0';
            }, 2000);
        }

        // Show achievement
        function showAchievement(title, icon) {
            elements.achievementBadge.querySelector('.badge-title').textContent = title;
            elements.achievementBadge.querySelector('.badge-icon').textContent = icon;
            
            elements.achievementBadge.classList.add('visible');
            
            // Close button
            elements.achievementBadge.querySelector('.badge-close').addEventListener('click', () => {
                elements.achievementBadge.classList.remove('visible');
            }, { once: true });
        }

        // Check for unlocked achievements
        function checkAchievements() {
            // Quick Learner achievement (complete 3 tasks)
            if (gameState.completedTasks.length >= 3 && 
                !gameState.achievements.includes('quick-learner')) {
                gameState.achievements.push('quick-learner');
                localStorage.setItem('chizelAchievements', JSON.stringify(gameState.achievements));
                showAchievement("Quick Learner", "🏎️");
                addXP(20);
            }
            
            // Math Whiz achievement
            const mathTasksCompleted = gameState.completedTasks.filter(id => 
                id === 'brain-teaser' || id === 'math-puzzle').length;
            if (mathTasksCompleted >= 3 && 
                !gameState.achievements.includes('math-whiz')) {
                gameState.achievements.push('math-whiz');
                localStorage.setItem('chizelAchievements', JSON.stringify(gameState.achievements));
                showAchievement("Math Whiz", "➕");
                addXP(50);
            }
            
            // Word Wizard achievement
            const wordTasksCompleted = gameState.completedTasks.filter(id => 
                id === 'quick-challenge' || id === 'word-game').length;
            if (wordTasksCompleted >= 3 && 
                !gameState.achievements.includes('word-wizard')) {
                gameState.achievements.push('word-wizard');
                localStorage.setItem('chizelAchievements', JSON.stringify(gameState.achievements));
                showAchievement("Word Wizard", "🔠");
                addXP(50);
            }
        }

        // Toggle Mummy assistant
        function toggleMummyAssistant(show) {
            if (show) {
                elements.mummyAssistant.classList.add('visible');
                elements.mummyInput.focus();
            } else {
                elements.mummyAssistant.classList.remove('visible');
                elements.mummyInput.value = '';
            }
        }

        // Handle Mummy query
        function handleMummyQuery() {
            const query = elements.mummyInput.value.trim().toLowerCase();
            if (!query) return;
            
            // Find matching knowledge
            let response = "I'm not sure about that. Try asking about: CHIZEL, learning, XP, levels, or parents.";
            
            for (const [keyword, info] of Object.entries(gameState.mummyKnowledge)) {
                if (query.includes(keyword)) {
                    response = info;
                    break;
                }
            }
            
            // Special responses
            if (query.includes('hello') || query.includes('hi')) {
                response = "Hi there! Ready to learn something new today?";
            } else if (query.includes('thank')) {
                response = "You're welcome! Learning is more fun when we help each other!";
            } else if (query.includes('parent')) {
                response = "Parents can see your progress in their special dashboard. They'll be so proud of your learning!";
            }
            
            elements.mummyMessage.textContent = response;
            elements.mummyInput.value = '';
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize the game when DOM is loaded
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>