<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chizel - Turning Screen Time To Skill Time!</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Comic+Neue:wght@400;700&display=swap">
        <link rel="icon" type="image/png" href="assets/logo.png">
    <style>
        :root {
            --primary: #4A90E2;
            --secondary: #50E3C2;
            --accent: #F8E71C;
            --dark: #1A2E40;
            --light: #E0F7FF;
            --success: #7ED321;
            --warning: #F5A623;
            --danger: #D0021B;
            --mummy-color: #4A90E2;
            --kid-color: #F5A623;
            --space-purple: #9013FE;
            --space-blue: #1A2E40;
            --neon-pink: #FF10F0;
            --neon-green: #39FF14;
            --space-orange: #FF6D3A;
            --space-pink: #FF3E9D;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: var(--space-blue);
            color: var(--light);
            height: 100vh;
            overflow: hidden;
            perspective: 1000px;
            font-size: 18px;
            touch-action: manipulation;
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        /* Animated Space Background */
        .space-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, var(--space-blue) 0%, #000000 100%);
            z-index: -2;
            overflow: hidden;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: -1;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle var(--duration, 5s) infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        .planet {
            position: absolute;
            border-radius: 50%;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
            animation: float var(--float-duration, 120s) infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0) translateX(0) rotate(0deg); }
            100% { transform: translateY(-1000px) translateX(500px) rotate(360deg); }
        }

        .comet {
            position: absolute;
            width: 6px;
            height: 6px;
            background: linear-gradient(to right, 
                rgba(255, 255, 255, 0) 0%, 
                rgba(255, 255, 255, 0.8) 50%, 
                rgba(255, 255, 255, 0) 100%);
            border-radius: 50%;
            filter: blur(1px);
            animation: comet var(--comet-duration, 10s) linear infinite;
            opacity: 0;
        }

        @keyframes comet {
            0% { 
                transform: translateX(0) translateY(0);
                opacity: 1;
            }
            100% { 
                transform: translateX(1000px) translateY(500px);
                opacity: 0;
            }
        }

        /* Nebula Animation */
        .nebula {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(106, 13, 173, 0.3) 0%, 
                rgba(48, 63, 159, 0.2) 50%, 
                transparent 70%);
            filter: blur(30px);
            animation: pulse 15s infinite alternate;
            z-index: -1;
        }

        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.3; }
            100% { transform: scale(1.2); opacity: 0.6; }
        }

        /* Main Game UI */
        .header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            z-index: 10;
            flex-wrap: wrap;
        }

        .back-btn {
            position: absolute;
            left: 15px;
            top: 15px;
            background: rgba(74, 144, 226, 0.3);
            border: 2px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 11;
        }

        .back-btn:hover {
            background: rgba(74, 144, 226, 0.5);
            transform: scale(1.1);
        }

        .back-btn svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .logo-container {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 15px;
            z-index: 11;
            text-align: center;
        }

        .logo {
            height: 50px;
            filter: drop-shadow(0 0 10px var(--secondary));
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.1) rotate(5deg);
            filter: drop-shadow(0 0 15px var(--neon-pink));
        }

        .logo-tagline {
            font-size: 12px;
            color: var(--secondary);
            text-shadow: 0 0 5px var(--secondary);
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .game-stats {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: flex-end;
            z-index: 10;
            background: rgba(26, 46, 64, 0.7);
            padding: 10px;
            border-radius: 15px;
            border: 2px solid var(--secondary);
            box-shadow: 0 0 15px rgba(80, 227, 194, 0.3);
        }

        /* Level Display */
        .level-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
        }

        .level-label {
            font-family: 'Fredoka', sans-serif;
            font-size: 16px;
            color: var(--accent);
            text-shadow: 0 0 5px var(--accent);
        }

        .level-value {
            font-family: 'Fredoka', sans-serif;
            font-size: 16px;
            color: white;
            text-shadow: 0 0 5px white;
            background: linear-gradient(135deg, var(--space-purple) 0%, var(--primary) 100%);
            padding: 4px 12px;
            border-radius: 20px;
            border: 2px solid var(--accent);
            box-shadow: 0 0 10px var(--accent),
                        inset 0 0 10px rgba(255, 255, 255, 0.3);
            min-width: 40px;
            text-align: center;
        }

        /* XP Bar Container */
        .xp-container {
            display: none;
            width: 150px;
            margin-top: 8px;
        }

        .xp-bar {
            width: 100%;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .xp-text {
            font-size: 12px;
            color: var(--light);
            text-align: center;
        }
        
        /* NEW STYLES FOR MOBILE LEVEL DISPLAY */
        .mobile-level-container {
            display: none;
            /* Hidden by default on desktop */
            background-color: rgba(26, 46, 64, 0.8);
            border: 2px solid var(--secondary);
            border-radius: 25px;
            padding: 8px 15px;
            box-shadow: 0 0 20px var(--secondary);
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .mobile-level-label {
            font-family: 'Fredoka', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
            text-shadow: 0 0 8px var(--accent);
        }

        .mobile-level-value {
            font-size: 20px;
            font-weight: 700;
            color: white;
            background: linear-gradient(135deg, var(--space-purple) 0%, var(--primary) 100%);
            padding: 6px 16px;
            border-radius: 20px;
            border: 2px solid var(--accent);
            box-shadow: 0 0 15px var(--accent);
            min-width: 45px;
            text-align: center;
        }


        /* Characters - Fixed positioning and animations */
        .character-container {
            position: absolute;
            bottom: 5%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 5%;
            z-index: 5;
            left: 0;
            right: 0;
        }

        .character {
            position: relative;
            width: 40%;
            max-width: 300px;
            bottom: 0;
            margin: 0;
            transition: all 0.3s ease;
        }

        .character:hover {
            transform: translateY(-10px) scale(1.05);
        }

        .character-image {
            position: relative;
            width: 100%;
            height: auto;
            transition: all 0.3s ease;
        }

        .character-image img {
            width: 100%;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 10px 20px rgba(74, 144, 226, 0.5));
            position: relative;
        }

        /* Speech Bubbles - Improved positioning */
        .speech-bubble {
            position: absolute;
            padding: 15px;
            border-radius: 20px;
            max-width: 300px;
            font-size: 20px;
            line-height: 1.4;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease;
            transform: scale(0);
            transform-origin: bottom;
            z-index: 6;
            font-family: 'Comic Neue', cursive;
        }

        .speech-bubble.visible {
            transform: scale(1);
        }

        .left-bubble {
            background-color: var(--dark);
            color: var(--light);
            left: 15%;
            bottom: 100%;
            margin-bottom: 20px;
            border: 3px solid var(--mummy-color);
            box-shadow: 0 0 20px var(--mummy-color);
        }

        .left-bubble::after {
            content: '';
            position: absolute;
            left: 20px;
            top: 100%;
            width: 0;
            height: 0;
            border: 15px solid transparent;
            border-top-color: var(--dark);
            border-bottom: 0;
            border-left: 0;
            margin-left: -8px;
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.3));
        }

        .right-bubble {
            background-color: var(--kid-color);
            color: var(--dark);
            right: 15%;
            bottom: 100%;
            margin-bottom: 20px;
            border: 3px solid var(--kid-color);
            box-shadow: 0 0 20px var(--kid-color);
            font-weight: bold;
        }

        .right-bubble::after {
            content: '';
            position: absolute;
            right: 20px;
            top: 100%;
            width: 0;
            height: 0;
            border: 15px solid transparent;
            border-top-color: var(--kid-color);
            border-bottom: 0;
            border-right: 0;
            margin-right: -8px;
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.3));
        }

        .bubble-content {
            min-height: 40px;
        }

        .typing-indicator {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 6px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: var(--light);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0);
            opacity: 0.6; }
            30% { transform: translateY(-5px); opacity: 1;
            }
        }

        /* Options Container - Simplified layout */
        .options-container {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            width: 90%;
            max-width: 700px;
            padding: 20px;
            background-color: rgba(26, 46, 64, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(80, 227, 194, 0.3);
            border: 3px solid var(--secondary);
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .options-container.visible {
            opacity: 1;
            pointer-events: all;
            transform: translateX(-50%) translateY(0);
        }

        .option-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            font-family: 'Fredoka', sans-serif;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            box-shadow: 0 5px 20px rgba(80, 227, 194, 0.4);
            flex: 1 1 180px;
            max-width: 300px;
        }

        .option-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(80, 227, 194, 0.6);
        }

        .option-btn:active {
            transform: translateY(2px);
        }

        /* Task Container - Simplified UI */
        .task-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            background: linear-gradient(135deg, rgba(26, 46, 64, 0.98) 0%, rgba(26, 46, 64, 0.98) 100%);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6);
            border: 3px solid var(--secondary);
            z-index: 20;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .task-container.visible {
            opacity: 1;
            pointer-events: all;
            transform: translate(-50%, -50%) scale(1);
        }

        .task-header {
            font-family: 'Fredoka', sans-serif;
            font-size: 24px;
            color: var(--secondary);
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 15px var(--secondary);
            letter-spacing: 1px;
        }

        .task-content {
            margin-bottom: 20px;
            font-size: 20px;
            line-height: 1.5;
        }

        .task-submit {
            display: block;
            margin: 20px auto 0;
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--success) 0%, var(--neon-green) 100%);
            color: var(--dark);
            border: none;
            border-radius: 50px;
            font-family: 'Fredoka', sans-serif;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(57, 255, 20, 0.5);
        }

        .task-submit:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(57, 255, 20, 0.7);
        }

        .task-submit:active {
            transform: translateY(2px);
        }

        .task-submit.hidden {
            display: none;
        }

        /* Brain Teaser Styles */
        .brain-teaser {
            text-align: center;
        }

        .teaser-question {
            font-size: 22px;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--light);
        }

        .teaser-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .teaser-option {
            padding: 15px;
            background-color: rgba(74, 144, 226, 0.2);
            border: 3px solid var(--primary);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light);
            font-size: 18px;
        }

        .teaser-option:hover {
            background-color: rgba(74, 144, 226, 0.4);
            transform: translateX(10px);
        }

        .teaser-option.selected {
            background-color: var(--primary);
            color: white;
            font-weight: bold;
            box-shadow: 0 0 20px var(--primary);
            transform: scale(1.08);
        }

        /* Quick Challenge Styles */
        .quick-challenge {
            text-align: center;
        }

        .drag-drop-area {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
            gap: 20px;
        }

        .drag-items, .drop-target {
            width: 100%;
            min-height: 180px;
            border: 3px dashed var(--secondary);
            border-radius: 15px;
            padding: 20px;
            background-color: rgba(80, 227, 194, 0.1);
            transition: all 0.3s ease;
        }

        .drag-item {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: grab;
            font-size: 18px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .drag-item:last-child {
            margin-bottom: 0;
        }

        .drag-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(80, 227, 194, 0.5);
        }

        .drag-item:active {
            cursor: grabbing;
        }

        .drop-target.highlight {
            border-color: var(--success);
            background-color: rgba(126, 211, 33, 0.15);
            box-shadow: 0 0 25px rgba(126, 211, 33, 0.4);
        }

        /* Learn a Fact Styles */
        .learn-fact {
            text-align: center;
        }

        .fact-content {
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--light);
            background-color: rgba(144, 19, 254, 0.25);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--neon-pink);
        }

        .fact-image {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            border: 3px solid var(--secondary);
        }

        .fact-question {
            font-size: 22px;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--light);
        }

        .fact-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .fact-option {
            padding: 15px;
            background-color: rgba(245, 166, 35, 0.2);
            border: 3px solid var(--kid-color);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light);
            font-size: 18px;
        }

        .fact-option:hover {
            background-color: rgba(245, 166, 35, 0.4);
            transform: translateX(10px);
        }

        .fact-option.selected {
            background-color: var(--kid-color);
            color: var(--dark);
            font-weight: bold;
            box-shadow: 0 0 20px var(--kid-color);
            transform: scale(1.08);
        }

        /* Reasoning Quiz Styles */
        .reasoning-quiz {
            text-align: center;
        }

        /* Word Unscramble Styles */
        .word-unscramble {
            text-align: center;
        }

        .unscramble-input {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            border: 3px solid var(--secondary);
            border-radius: 10px;
            background-color: rgba(80, 227, 194, 0.15);
            color: white;
            font-size: 18px;
            text-align: center;
            text-transform: uppercase;
        }

        .unscramble-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent);
        }

        /* Coding Challenge Styles */
        .coding-challenge {
            text-align: center;
        }

        .code-instruction {
            font-size: 22px;
            margin-bottom: 20px;
            color: var(--light);
        }

        .code-editor {
            width: 100%;
            height: 200px;
            background-color: #1E1E2E;
            border: 3px solid var(--secondary);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: var(--light);
            margin-bottom: 20px;
            resize: none;
            line-height: 1.5;
        }

        .code-output {
            width: 100%;
            min-height: 100px;
            background-color: #1E1E2E;
            border: 3px solid var(--secondary);
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: var(--light);
            margin-bottom: 20px;
            text-align: left;
            white-space: pre-wrap;
        }

        /* Memory Game Styles - Fixed 3x3 grid */
        .memory-game {
            text-align: center;
        }

        .memory-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 400px;
        }

        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
            position: relative;
        }

        .memory-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--secondary);
        }

        .memory-card.flipped {
            background: var(--dark);
            transform: rotateY(180deg);
        }

        .memory-card.matched {
            background: var(--success);
            transform: rotateY(180deg);
            cursor: default;
            pointer-events: none;
        }

        /* Word Arrangement Task - More concise UI */
        .word-arrangement {
            text-align: center;
        }

        .word-arrangement-instruction {
            font-size: 22px;
            margin-bottom: 20px;
        }

        .word-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 500px;
        }

        .word-tile {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px;
            padding: 15px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .word-tile:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(80, 227, 194, 0.5);
        }

        .word-tile.selected {
            background: var(--accent);
            color: var(--dark);
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--accent);
        }

        .word-submit {
            margin-top: 20px;
        }

        /* Scenario Quiz Styles (NEW) */
        .scenario-quiz {
            text-align: center;
        }

        .scenario-text {
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--light);
            background-color: rgba(144, 19, 254, 0.25);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--neon-pink);
        }

        .scenario-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .scenario-option {
            padding: 15px;
            background-color: rgba(80, 227, 194, 0.2);
            border: 3px solid var(--secondary);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light);
            font-size: 18px;
            text-align: left;
        }

        .scenario-option:hover {
            background-color: rgba(80, 227, 194, 0.4);
            transform: translateX(10px);
        }

        .scenario-option.selected {
            background-color: var(--secondary);
            color: var(--dark);
            font-weight: bold;
            box-shadow: 0 0 20px var(--secondary);
            transform: scale(1.08);
        }

        /* Riddle Styles (NEW) */
        .riddle {
            text-align: center;
        }

        .riddle-text {
            font-size: 22px;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--light);
            background-color: rgba(255, 111, 58, 0.25);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--space-orange);
        }

        .riddle-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .riddle-option {
            padding: 15px;
            background-color: rgba(255, 111, 58, 0.2);
            border: 3px solid var(--space-orange);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light);
            font-size: 18px;
        }

        .riddle-option:hover {
            background-color: rgba(255, 111, 58, 0.4);
            transform: translateX(10px);
        }

        .riddle-option.selected {
            background-color: var(--space-orange);
            color: white;
            font-weight: bold;
            box-shadow: 0 0 20px var(--space-orange);
            transform: scale(1.08);
        }

        /* Achievement Badges */
        .achievement-badge {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
            z-index: 30;
            opacity: 0;
            transition: all 0.5s ease;
            max-width: 350px;
            border: 4px solid var(--accent);
        }

        .achievement-badge.visible {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .badge-icon {
            font-size: 50px;
            margin-bottom: 20px;
            color: var(--accent);
            text-shadow: 0 0 15px var(--accent);
        }

        .badge-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 24px;
            margin-bottom: 15px;
            color: white;
        }

        .badge-desc {
            font-size: 18px;
            margin-bottom: 20px;
            color: white;
        }

        .badge-close {
            padding: 12px 25px;
            background: var(--accent);
            border: none;
            border-radius: 50px;
            font-family: 'Fredoka', sans-serif;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .badge-close:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px var(--accent);
        }

        /* Confetti Effect */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0;
            z-index: 100;
            animation: confetti-fall 5s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Daily Reward Button */
        .daily-reward-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            background: rgba(80, 227, 194, 0.3);
            border: 3px solid var(--secondary);
            border-radius: 50px;
            color: white;
            font-family: 'Fredoka', sans-serif;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .daily-reward-btn:hover {
            background: rgba(80, 227, 194, 0.5);
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 5px 20px var(--secondary);
        }

        /* Story Progress Tracker */
        .story-tracker {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 6px;
            z-index: 10;
        }

        .story-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(80, 227, 194, 0.4);
            transition: all 0.3s ease;
        }

        .story-dot.active {
            background-color: var(--secondary);
            transform: scale(1.5);
            box-shadow: 0 0 15px var(--secondary);
        }

        /* Chizel App Promotion */
        .chizel-promo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 90%;
            max-width: 600px;
            background: linear-gradient(135deg, rgba(26, 46, 64, 0.98) 0%, rgba(26, 46, 64, 0.98) 100%);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
            border: 3px solid var(--secondary);
            z-index: 30;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s ease;
            backdrop-filter: blur(10px);
        }

        .chizel-promo.visible {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            pointer-events: all;
        }

        .promo-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .promo-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            color: white;
        }

        .promo-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 20px;
            color: var(--secondary);
            text-shadow: 0 0 15px var(--secondary);
        }

        .promo-message {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--light);
        }

        .promo-button {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--neon-pink) 0%, var(--space-purple) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(144, 19, 254, 0.5);
        }

        .promo-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(144, 19, 254, 0.7);
        }

        .promo-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--light);
            font-size: 20px;
            cursor: pointer;
        }

        /* Power Up Effect */
        .power-up-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(80, 227, 194, 0.4) 0%, transparent 70%);
            z-index: 25;
            opacity: 0;
            pointer-events: none;
            animation: pulse 2s infinite;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }
            
            .character {
                width: 45%;
                max-width: 200px;
                bottom: 8%; /* Increased from 5% */
            }
            
            .left-bubble {
                left: 10%;
                bottom: 100%;
                max-width: 250px;
                font-size: 18px;
            }
            
            .right-bubble {
                right: 10%;
                bottom: 100%;
                max-width: 250px;
                font-size: 18px;
            }
            
            .options-container {
                bottom: 12%;
                /* Increased from 8% */
                padding: 15px;
            }
            
            .option-btn {
                font-size: 16px;
                padding: 12px 18px;
                flex: 1 1 150px;
            }
            
            .task-container {
                padding: 20px;
            }

            .task-header {
                font-size: 22px;
            }

            .teaser-question, .fact-question {
                font-size: 20px;
            }

            .memory-board {
                max-width: 350px;
            }

            .header {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                padding: 15px;
                z-index: 10;
                display: block;
            }
            
            /* HIDE original stats and SHOW new level display on mobile */
            .game-stats {
                display: none;
            }
            
            .mobile-level-container {
                display: inline-flex;
                position: absolute;
                top: 95px; /* Position below logo */
                left: 50%;
                transform: translateX(-50%);
            }
            
            /* Show XP bar on mobile */
            .xp-container {
                display: block;
                width: 120px;
                margin-top: 8px;
            }
            
            /* Adjust daily reward button position */
            .daily-reward-btn {
                bottom: 25px;
                /* Increased from 20px */
            }
            
            /* Level Bar Styles */
            .level-bar-container {
                display: none;
                align-items: center;
                width: 150px;
                margin-top: 5px;
            }
        
            .level-bar {
                width: 100%;
                height: 8px;
                background-color: rgba(255, 255, 255, 0.2);
                border-radius: 4px;
                overflow: hidden;
            }
        
            .level-progress {
                height: 100%;
                background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
                border-radius: 4px;
                transition: width 0.5s ease;
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }
            .mobile-level-container {
                top: 80px;
                /* This adds the needed gap on small screens */
            }
            
            .character {
                width: 50%;
                max-width: 160px;
                bottom: 10%; /* Increased from 3% */
            }
            
            .left-bubble {
                left: 5%;
                bottom: 100%;
                max-width: 200px;
                font-size: 16px;
                padding: 12px;
            }
            
            .right-bubble {
                right: 5%;
                bottom: 100%;
                max-width: 200px;
                font-size: 16px;
                padding: 12px;
            }
            
            .options-container {
                bottom: 15%;
                /* Increased from 5% */
                padding: 12px;
                gap: 10px;
            }
            
            .option-btn {
                font-size: 14px;
                padding: 10px 15px;
                flex: 1 1 120px;
            }
            
            .task-container {
                padding: 15px;
            }

            .task-header {
                font-size: 20px;
            }

            .teaser-question, .fact-question {
                font-size: 18px;
            }

            .memory-board {
                max-width: 280px;
                gap: 8px;
            }

            .memory-card {
                font-size: 24px;
            }

            .word-tile {
                padding: 10px;
                font-size: 16px;
                min-height: 50px;
            }

            .daily-reward-btn {
                font-size: 14px;
                padding: 8px 12px;
                bottom: 30px; /* Increased from default */
            }

            .logo {
                height: 35px;
            }

            .logo-tagline {
                font-size: 9px;
            }
            
            .mobile-level-container {
                top: 80px;
                /* Adjust for smaller logo */
            }

            .mobile-level-label {
                font-size: 16px;
            }

            .mobile-level-value {
                font-size: 16px;
                padding: 4px 12px;
            }

            /* XP bar for small mobile */
            .xp-container {
                width: 100px;
            }
            
            .xp-text {
                font-size: 10px;
            }
            
            /* Adjust story tracker position */
            .story-tracker {
                bottom: 25px;
                /* Increased from 20px */
            }
        }

        /* Animation Classes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .bounce {
            animation: bounce 0.5s ease infinite;
        }

        /* Character animations */
        @keyframes characterFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); } /* Reduced from -15px to -5px */
        }

        .character-float {
            animation: characterFloat 3s ease-in-out infinite;
        }

        /* Emotional animations */
        @keyframes characterHappy {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-5px) scale(1.02); } /* Reduced movement */
        }

        .character-happy {
            animation: characterHappy 2s ease infinite;
        }

        @keyframes characterExcited {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-5px); } /* Reduced from -15px */
            75% { transform: translateY(-5px); } /* Reduced from -15px */
        }

        .character-excited {
            animation: characterExcited 1s ease infinite;
        }
        
    </style>
</head>
<body>
    <div class="game-container">
        <div class="space-background">
            <div class="stars" id="stars"></div>
            <div class="nebula" style="top: 20%; left: 10%;"></div>
            <div class="nebula" style="top: 60%; left: 70%;"></div>
            <div class="planet" style="width: 150px; height: 150px; background: radial-gradient(circle at 30% 30%, #9013FE, #1A2E40); top: 15%; left: 70%; --float-duration: 300s;"></div>
            <div class="planet" style="width: 120px; height: 120px; background: radial-gradient(circle at 30% 30%, #F5A623, #D0021B); top: 70%; left: 10%; --float-duration: 250s;"></div>
            <div class="comet" style="top: 10%; left: 5%; --comet-duration: 15s;"></div>
            <div class="comet" style="top: 30%; left: 80%; --comet-duration: 20s;"></div>
        </div>

        <div class="header">
            <button class="back-btn" id="back-btn">
    <svg viewBox="0 0 24 24">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
    </svg>
</button>

            <div class="logo-container">
                <img src="assets/logo.png" alt="Chizel Logo" class="logo">
                <div class="logo-tagline">Turning Screen Time To Skill Time!</div>
            </div>

            <div class="mobile-level-container">
                <span class="mobile-level-label">LEVEL:</span>
                <span class="mobile-level-value" id="mobile-level-value">1</span>
            </div>

            <div class="game-stats">
                <div class="level-container">
                    <div class="level-label">LEVEL:</div>
                    <div class="level-value">1</div>
                </div>
            </div>
        </div>

        <div class="character-container">
            <div class="character left character-float">
                <div class="character-image">
                    <img src="assets/mummy.png" alt="Mummy the Learning Guide">
                </div>
                <div class="speech-bubble left-bubble" id="mother-speech">
                    <div class="bubble-content"></div>
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>
            <div class="character right character-float">
                <div class="character-image">
                    <img src="assets/kid.png" alt="You">
                </div>
                <div class="speech-bubble right-bubble" id="kid-speech">
                    <div class="bubble-content"></div>
                </div>
            </div>
        </div>

        <div class="options-container"></div>

        <div class="task-container">
            <div class="task-header"></div>
            <div class="task-content"></div>
            <button class="task-submit hidden">Submit</button>
        </div>

        <div class="story-tracker" id="story-tracker"></div>

        <button class="daily-reward-btn" id="daily-reward-btn">
            <span>üéÅ</span> Daily Reward
        </button>

        <div class="achievement-badge" id="achievement-badge">
            <div class="badge-icon">üèÜ</div>
            <div class="badge-title">ACHIEVEMENT UNLOCKED!</div>
            <div class="badge-desc">You earned the 'Quick Learner' badge!</div>
            <button class="badge-close">Awesome!</button>
        </div>

        <div class="power-up-effect" id="power-up-effect"></div>

        <div class="chizel-promo" id="chizel-promo">
            <button class="promo-close" id="promo-close">√ó</button>
            <div class="promo-header">
                <div class="promo-avatar">M</div>
                <div class="promo-title">LAUNCHING SOON!<br>THE CHIZEL APP üíô</div>
            </div>
            <div class="promo-message">
                Wow! You're doing amazing! Did you know our CHIZEL app has even more fun learning games and adventures?<br><br>
                Get the full experience with 100+ activities, daily challenges, and special rewards!
            </div>
            <button class="promo-button" id="promo-button">
                Download CHIZEL App Now
            </button>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            currentStep: 0,
            xp: 0,
            level: 1,
            completedTasks: [],
            achievements: [],
            currentTask: null,
            taskCompleted: false,
            storyProgress: 0,
            lastLoginDate: null,
            audioEnabled: false
        };
        
        // DOM Elements
        const elements = {
            leftCharacter: document.querySelector('.character.left'),
            rightCharacter: document.querySelector('.character.right'),
            motherSpeech: document.getElementById('mother-speech'),
            kidSpeech: document.getElementById('kid-speech'),
            motherBubbleContent: document.querySelector('#mother-speech .bubble-content'),
            kidBubbleContent: document.querySelector('#kid-speech .bubble-content'),
            optionsContainer: document.querySelector('.options-container'),
            levelValue: document.querySelector('.level-value'),
            mobileLevelValue: document.getElementById('mobile-level-value'), // NEW
            levelProgress: document.getElementById('level-progress'),
            xpProgress: document.getElementById('xp-progress'),
            xpText: document.getElementById('xp-text'),
            taskContainer: document.querySelector('.task-container'),
            taskContent: document.querySelector('.task-content'),
            taskSubmit: document.querySelector('.task-submit'),
            taskHeader: document.querySelector('.task-header'),
            typingIndicator: document.querySelector('.typing-indicator'),
            starsContainer: document.getElementById('stars'),
            storyTracker: document.getElementById('story-tracker'),
            dailyRewardBtn: document.getElementById('daily-reward-btn'),
            achievementBadge: document.getElementById('achievement-badge'),
            powerUpEffect: document.getElementById('power-up-effect'),
            backBtn: document.getElementById('back-btn'),
            chizelPromo: document.getElementById('chizel-promo'),
            promoClose: document.getElementById('promo-close'),
            promoButton: document.getElementById('promo-button')
        };
        
        // Create stars for background
        function createStars() {
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = `${Math.random() * 3 + 1}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.opacity = Math.random();
                star.style.animationDelay = `${Math.random() * 5}s`;
                star.style.setProperty('--duration', `${Math.random() * 3 + 2}s`);
                elements.starsContainer.appendChild(star);
            }
        }
 
        // Story Script ‚Äì Emotional, Interactive, and Logically Structured
        const storyScript = [
          // Step 0: Warm Welcome
          {
            id: 0,
            speaker: 'mummy',
            message: "üëã Hello my little star! I‚Äôm so happy to see you today. Welcome to CHIZEL ‚Äî where screen time becomes growth time.",
            options: [
              { text: "Hi Mummy, what‚Äôs CHIZEL?", nextStep: 1, xp: 5, emotion: 'curious' },
              { text: "I‚Äôm ready to learn!", nextStep: 2, xp: 5, emotion: 'excited' }
            ]
          },

          // Step 1: Intro to CHIZEL (from curiosity)
          {
            id: 1,
            speaker: 'mummy',
            message: "CHIZEL is our safe space for learning and fun. Every game here makes your mind stronger and your heart happier.",
            options: [
              { text: "That sounds wonderful!", nextStep: 3, xp: 5, emotion: 'happy' },
              { text: "What will I do today?", nextStep: 4, xp: 5, emotion: 'curious' }
            ]
          },

          // Step 2: Eager player goes straight to encouragement
          {
            id: 2,
            speaker: 'mummy',
            message: "Each challenge you complete earns XP and shows how much you‚Äôre growing. You‚Äôre already making me so proud.",
            options: [
              { text: "Let‚Äôs start, I‚Äôm excited!", nextStep: 5, xp: 10, emotion: 'excited' },
              { text: "Tell me more first!", nextStep: 6, xp: 5, emotion: 'curious' }
            ]
          },

          // Step 3: From "That sounds wonderful!" to what's next
          {
            id: 3,
            speaker: 'mummy',
            message: "Each challenge helps you grow smarter and stronger. And guess what? You earn XP with every step!",
            options: [
              { text: "Yay! Let‚Äôs play!", nextStep: 5, xp: 10, emotion: 'excited' },
              { text: "Tell me more!", nextStep: 6, xp: 5, emotion: 'curious' }
            ]
          },

          // Step 4: Activities preview
          {
            id: 4,
            speaker: 'mummy',
            message: "Today we have puzzles, memory games, and word adventures ‚Äî all chosen just for you.",
            options: [
              { text: "Sounds fun! Let‚Äôs start!", nextStep: 5, xp: 10, emotion: 'excited' },
              { text: "How will this help me?", nextStep: 7, xp: 5, emotion: 'curious' }
            ]
          },

          // Step 5: Transition to tasks
          {
            id: 5,
            speaker: 'mummy',
            message: "Alright champ! Your first mission has 5 fun challenges. I‚Äôll be right here, cheering for you all the way.",
            options: [],
            action: 'startTasks',
            emotion: 'proud'
          },

          // Step 6: Explain rewards + levels
          {
            id: 6,
            speaker: 'mummy',
            message: "As you level up, games unlock new worlds. Each level is a step in your real-life growth journey. I‚Äôm already imagining your bright future.",
            options: [
              { text: "Let‚Äôs go, Mummy!", nextStep: 5, xp: 5, emotion: 'excited' },
              { text: "What do levels mean?", nextStep: 8, xp: 5, emotion: 'curious' }
            ]
          },

          // Step 7: Why games help you
          {
            id: 7,
            speaker: 'mummy',
            message: "Every game trains your brain like exercise trains muscles. Soon you‚Äôll notice ‚Äî sharper focus, better memory, quicker problem solving.",
            options: [
              { text: "Wow, I‚Äôm ready to grow!", nextStep: 5, xp: 10, emotion: 'happy' },
              { text: "Show me a game please!", nextStep: 5, xp: 5, emotion: 'curious' }
            ]
          },

          // Step 8: Explaining Levels
          {
            id: 8,
            speaker: 'mummy',
            message: "Levels show how far you've come. The more you play and grow, the more amazing new things unlock ‚Äî just for you!",
            options: [
              { text: "I want to unlock everything!", nextStep: 5, xp: 10, emotion: 'excited' },
              { text: "What else makes CHIZEL special?", nextStep: 9, xp: 5, emotion: 'curious' }
            ]
          },

          // Step 9: CHIZEL‚Äôs uniqueness
          {
            id: 9,
            speaker: 'mummy',
            message: "Sweetheart, CHIZEL is safe. No strangers, no ads. Only pure learning and love. Parents can also see how amazing you‚Äôre becoming.",
            options: [
              { text: "I love making them proud!", nextStep: 5, xp: 15, emotion: 'happy' },
              { text: "Anything else that‚Äôs special?", nextStep: 10, xp: 5, emotion: 'curious' }
            ]
          },

          // Step 10: Final reassurance
          {
            id: 10,
            speaker: 'mummy',
            message: "What makes CHIZEL special? It learns with you, adapts to you, and makes every day joyful. It‚Äôs built with care, like a gift from me to you.",
            options: [
              { text: "I already love it!", nextStep: 5, xp: 20, emotion: 'excited' },
              { text: "Let‚Äôs start right now!", nextStep: 5, xp: 10, emotion: 'excited' }
            ]
          },

          // Final Step (after tasks)
          {
            id: 11,
            speaker: 'mummy',
            message: "‚≠ê Incredible job, my superstar! ‚≠ê You‚Äôve earned 250 XP and grown so much today. My heart is full of pride.",
            options: [],
            action: 'showFinalMessage',
            emotion: 'proud'
          }
        ];

        // Task Data - Updated with 5 questions and new word wizard sentence
        const tasks = [
            {
                id: 'brain-teaser',
                title: "üöÄ MATH QUEST: Save the Hungry Aliens!",
                type: "brain-teaser",
                question: "üëΩ Aliens are trapped on a planet! Each alien needs 5 üç™ to survive. You have 20 üç™. How many aliens can you save before the spaceship leaves? ‚è≥",
                options: ["4 aliens üõ∏", "6 aliens üëΩ", "5 aliens üöÄ", "3 aliens üåå"],
                correctAnswer: 0,
                xp: 70
            },
            {
                id: 'memory-game',
                title: "ü™ê MEMORY MASTER: Match the Cosmic Planets",
                type: "memory-game",
                instruction: "üöÄ Your rocket fuel ‚õΩ is locked! Match the cards (üåç üåï ü™ê ‚òÄÔ∏è üöÄ üëΩ) to unlock the booster and continue your space journey! üåå",
                pairs: ["üåç", "üåï", "ü™ê", "‚òÄÔ∏è", "üöÄ", "üëΩ"],
                xp: 70
            },
            {
                id: 'word-arrangement-india-4',
                title: "üìú WORD WIZARD: Anthem Builder",
                type: "word-arrangement",
                instruction: "‚ú® The magic scroll is broken! ü™Ñ Arrange the words to rebuild India‚Äôs national anthem üáÆüá≥ correctly:",
                words: ["of", "India", "the", "anthem", "is", "national", "Gana", "Jana", "Mana"],
                correctOrder: ["Jana", "Gana", "Mana", "is", "the", "national", "anthem", "of", "India"],
                xp: 70
            },
            {
                id: 'learn-fact',
                title: "üåç SCIENCE DISCOVERY: Animal Wonders",
                type: "learn-fact",
                fact: "üí° Did you know? A group of flamingos is called a 'flamboyance'! ü¶© Their pink color comes from the shrimp üç§ they eat.",
                question: "‚ùì What gives flamingos their pink color?",
                options: ["‚òÄÔ∏è The sun", "üç§ The shrimp they eat", "ü™∂ Pink feathers", "üíß The water"],
                correctAnswer: 1,
                xp: 70
            },
            {
                id: 'math-puzzle',
                title: "üí∞ NUMBER NINJA: Treasure Hunt",
                type: "brain-teaser",
                question: "üèùÔ∏è You found 12 gold coins üí∞ in a cave, then 8 more in a chest üóùÔ∏è, but a sneaky parrot ü¶ú stole 5! How many do you have left?",
                options: ["15 coins üèÜ", "20 coins üíé", "10 coins üìâ", "25 coins üéâ"],
                correctAnswer: 0,
                xp: 70
            },
            {
                id: 'reasoning-quiz',
                title: "üß† LOGIC MASTER: The Puzzle Gate",
                type: "reasoning-quiz",
                instruction: "‚ö° A magical gate blocks your path. Solve 5 riddles of logic to unlock it üîë:",
                questions: [
                    {
                        question: "What word becomes shorter when you add two letters to it? ‚úçÔ∏è",
                        options: ["Long", "Short", "Small", "Tiny"],
                        correctAnswer: 1
                    },
                    {
                        question: "Which shape has 3 sides? üî∫",
                        options: ["Square", "Circle", "Triangle", "Star"],
                        correctAnswer: 2
                    },
                    {
                        question: "How many months have 28 days? üìÖ",
                        options: ["1", "2", "6", "All of them"],
                        correctAnswer: 3
                    },
                    {
                        question: "What comes next in this pattern: 2, 4, 8, 16, ___? üî¢",
                        options: ["18", "20", "24", "32"],
                        correctAnswer: 3
                    },
                    {
                        question: "If you have only one match and enter a room with an oil lamp, a candle, and a fireplace, what do you light first? üïØÔ∏è",
                        options: ["Oil lamp", "Candle", "Fireplace", "The match"],
                        correctAnswer: 3
                    }
                ],
                xp: 100
            },
            // NEW TASKS üöÄ (Values + Ethics + Critical Thinking)
            {
                id: 'values-task',
                title: "‚ù§Ô∏è KINDNESS QUEST: The Lost Wallet",
                type: "scenario-quiz",
                question: "üíº You find a wallet on the road with ‚Çπ2000 inside. What will you do? ü§î",
                options: [
                    "Keep it ü§ë",
                    "Donate it üíù",
                    "Return it to the owner üôå",
                    "Throw it away üöÆ"
                ],
                correctAnswer: 2,
                xp: 80
            },
            {
                id: 'ethics-task',
                title: "‚öñÔ∏è ETHICS DILEMMA: The Exam Helper",
                type: "scenario-quiz",
                question: "üìö During an exam, your best friend asks for help by cheating. What is the best ethical choice?",
                options: [
                    "Help them üëÄ",
                    "Say no politely üôè",
                    "Give wrong answers üòà",
                    "Ignore completely üò∂"
                ],
                correctAnswer: 1,
                xp: 80
            },
            {
                id: 'critical-thinking-task-4',
                title: "üï∞Ô∏è CRITICAL THINKING: The Upside-Down Clock",
                type: "riddle",
                question: "‚è∞ You look at a clock and the time is 3:15. If you turn the clock upside down, what time will it look like?",
                options: [
                    "9:45 üîÑ",
                    "6:30 üîÉ",
                    "12:00 üîÅ",
                    "3:15 üîÇ"
                ],
                correctAnswer: 0,
                xp: 90
            }
        ];
        
        // Achievements Data
        const achievements = [
            {
                id: 'quick-learner',
                title: "Quick Learner",
                description: "Completed 3 challenges quickly!",
                icon: "üèéÔ∏è",
                xpBonus: 20
            },
            {
                id: 'daily-star',
                title: "Daily Star",
                description: "Played 3 days in a row!",
                icon: "üåü",
                xpBonus: 30
            },
            {
                id: 'math-whiz',
                title: "Math Whiz",
                description: "Solved 10 math problems!",
                icon: "‚ûï",
                xpBonus: 50
            },
            {
                id: 'word-wizard',
                title: "Word Wizard",
                description: "Completed 5 word challenges!",
                icon: "üèéÔ∏è",
                xpBonus: 50
            },
            {
                id: 'science-star',
                title: "Science Star",
                description: "Learned 10 science facts!",
                icon: "üî¨",
                xpBonus: 50
            },
            // NEW ACHIEVEMENTS
            {
                id: 'values-champion',
                title: "Values Champion",
                description: "Completed all values-based challenges!",
                icon: "‚ù§Ô∏è",
                xpBonus: 60
            },
            {
                id: 'ethics-guardian',
                title: "Ethics Guardian",
                description: "Made ethical choices in all scenarios!",
                icon: "‚öñÔ∏è",
                xpBonus: 70
            },
            {
                id: 'critical-thinker',
                title: "Critical Thinker",
                description: "Solved all critical thinking puzzles!",
                icon: "üîç",
                xpBonus: 80
            }
        ];
        
        // Initialize the game
        function initGame() {
            createStars();
            updateLevel();
            updateXPBar();
            showStoryStep(0);
            createStoryTracker();
            checkDailyReward();
            
            // Set up task submit button
            elements.taskSubmit.addEventListener('click', checkTaskAnswer);
            // Set up daily reward button
            elements.dailyRewardBtn.addEventListener('click', giveDailyReward);
            // Set up back button
            // Set up back button
            elements.backBtn.addEventListener('click', () => {
                // If the page is inside an iframe (like on the main site),
                // send a message to the parent window to exit fullscreen.
                if (window.self !== window.top) {
                    window.parent.postMessage('closeChizelverseDemo', '*');
                } else {
                    // Otherwise, it's in its own tab. First, try to close it.
                    // This works if the tab was opened by a script.
                    window.close();

                    // As a fallback for cases where the tab can't be closed automatically,
                    // this will navigate back to the previous page in the browser's history.
                    setTimeout(() => {
                        if (!window.closed) {
                            window.history.back();
                        }
                    }, 100);
                }
            });
            // Set up Chizel app promotion
            elements.promoClose.addEventListener('click', () => toggleChizelPromo(false));
            elements.promoButton.addEventListener('click', () => {
                alert("Redirecting to app store to download CHIZEL app!");
                toggleChizelPromo(false);
            });
            // Show characters with animation
            setTimeout(() => {
                elements.leftCharacter.classList.add('visible');
                elements.rightCharacter.classList.add('visible');
            }, 500);
            // Check for achievements
            checkAchievements();
        }

        // NEW: Function to reset the game state for "Play Again"
        function resetGame() {
            // Reset game state variables
            gameState.currentStep = 0;
            gameState.xp = 0;
            gameState.level = 1;
            gameState.completedTasks = [];
            gameState.achievements = [];
            gameState.currentTask = null;
            gameState.taskCompleted = false;
            
            // Update UI elements to reflect the reset state
            updateLevel();
            updateXPBar();
            
            // Hide the task container and restart the story
            elements.taskContainer.classList.remove('visible');
            showStoryStep(0);
        }

        // Toggle Chizel app promotion
        function toggleChizelPromo(show) {
            if (show) {
                elements.chizelPromo.classList.add('visible');
            } else {
                elements.chizelPromo.classList.remove('visible');
            }
        }

        // Check for daily reward eligibility
        function checkDailyReward() {
            const today = new Date().toDateString();
            if (gameState.lastLoginDate !== today) {
                elements.dailyRewardBtn.style.display = 'flex';
            } else {
                elements.dailyRewardBtn.style.display = 'none';
            }
        }

        // Give daily reward
        function giveDailyReward() {
            const today = new Date().toDateString();
            gameState.lastLoginDate = today;
            localStorage.setItem('chizelLastLogin', today);
            
            // Weekend bonus
            const isWeekend = [0, 6].includes(new Date().getDay());
            const rewardAmount = isWeekend ? 50 : 30;
            
            addXP(rewardAmount);
            showAchievement(`Daily Reward: ${rewardAmount} XP!`, isWeekend ? "üéâ" : "üéÅ");
            elements.dailyRewardBtn.style.display = 'none';
        }

        // Create story progress tracker
        function createStoryTracker() {
            elements.storyTracker.innerHTML = '';
            for (let i = 0; i < storyScript.length; i++) {
                const dot = document.createElement('div');
                dot.className = 'story-dot';
                if (i === gameState.currentStep) {
                    dot.classList.add('active');
                }
                elements.storyTracker.appendChild(dot);
            }
        }

        // Update story tracker
        function updateStoryTracker() {
            const dots = document.querySelectorAll('.story-dot');
            dots.forEach((dot, index) => {
                if (index === gameState.currentStep) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        // Show story step
        function showStoryStep(stepIndex) {
            gameState.currentStep = stepIndex;
            const step = storyScript[stepIndex];
            
            if (!step) return;
            
            // Update story progress
            gameState.storyProgress = (stepIndex / storyScript.length) * 100;
            // Clear options
            elements.optionsContainer.innerHTML = '';
            elements.optionsContainer.classList.remove('visible');
            // Hide kid bubble if it's Mummy's turn to speak
            elements.kidSpeech.classList.remove('visible');
            // Set character emotion
            setCharacterEmotion(step.emotion || 'normal');
            if (step.speaker === 'mummy') {
                // Show typing indicator
                elements.motherSpeech.classList.add('visible');
                elements.motherBubbleContent.innerHTML = '';
                elements.typingIndicator.style.display = 'flex';
                // Type out the message
                typeMessage(step.message, elements.motherBubbleContent, () => {
                    // Hide typing indicator when done
                    elements.typingIndicator.style.display = 'none';
                    
                    // If there's an action, perform it
                    if (step.action) {
                        performAction(step.action);
                    }
                    
                    // Show options if they exist
                    if (step.options && step.options.length > 0) {
                        showOptions(step.options);
                    }
                });
            } else {
                // For user responses
                elements.kidBubbleContent.textContent = step.message;
                elements.kidSpeech.classList.add('visible');
                
                // Move to next step after delay
                setTimeout(() => {
                    showStoryStep(step.nextStep);
                }, 1000);
            }
            
            // Update story tracker
            updateStoryTracker();
        }

        // Set character emotion
        function setCharacterEmotion(emotion) {
            // Remove all emotion classes
            elements.leftCharacter.classList.remove('character-happy', 'character-excited');
            // Add appropriate emotion class
            if (emotion === 'happy') {
                elements.leftCharacter.classList.add('character-happy');
            } else if (emotion === 'excited' || emotion === 'proud') {
                elements.leftCharacter.classList.add('character-excited');
            }
        }

        // Type message with typing animation
        function typeMessage(message, element, callback) {
            // This line correctly handles emojis and other multi-byte characters
            const chars = Array.from(message);
            let i = 0;
            element.textContent = '';
            
            function typing() {
                if (i < chars.length) {
                    element.textContent += chars[i];
                    i++;
                    setTimeout(typing, 20); // Typing speed
                } else if (callback) {
                    callback();
                }
            }
            
            typing();
        }

        // Show response options
        function showOptions(options) {
            elements.optionsContainer.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option.text;
                
                button.addEventListener('click', () => {
                    // Show user's response
                    showUserResponse(option.text);
                    
                    // Add XP if specified
                    if (option.xp) {
                        addXP(option.xp);
                    }
                    
                    // Set character emotion based on option
                    setCharacterEmotion(option.emotion || 'happy');
                    
                    // Move to next step after delay
                    setTimeout(() => {
                        if (option.nextStep !== undefined) {
                            showStoryStep(option.nextStep);
                        }
                    }, 800);
                });
                elements.optionsContainer.appendChild(button);
            });
            
            elements.optionsContainer.classList.add('visible');
        }

        // Show user response in bubble
        function showUserResponse(message) {
            elements.kidBubbleContent.textContent = message;
            elements.kidSpeech.classList.add('visible');
            elements.optionsContainer.classList.remove('visible');
            elements.motherSpeech.classList.remove('visible');
        }

        // Perform special action
        function performAction(action) {
            switch (action) {
                case 'startTasks':
                    startTasks();
                    break;
                case 'showFinalMessage':
                    showFinalMessage();
                    break;
            }
        }

        // Start tasks
        function startTasks() {
            // Reset completed tasks
            gameState.completedTasks = [];
            gameState.taskCompleted = false;
            
            // Show first task
            showTask(0);
        }

        // Show task
        function showTask(taskIndex) {
            const availableTasks = tasks.filter(t => !gameState.completedTasks.includes(t.id));
            if (availableTasks.length === 0)

{ // End after 5 tasks
                // All tasks completed
                showStoryStep(11); // Go to final story step
                return;
            }
            
            const task = availableTasks[0]; // Always show the next available task
            gameState.currentTask = task;
            
            // Set task header
            elements.taskHeader.textContent = task.title;
            // Clear previous task content
            elements.taskContent.innerHTML = '';
            elements.taskSubmit.classList.add('hidden');
            // Create task based on type
            switch (task.type) {
                case 'brain-teaser':
                    createBrainTeaser(task);
                    break;
                case 'memory-game':
                    createMemoryGame(task);
                    break;
                case 'word-arrangement':
                    createWordArrangement(task);
                    break;
                case 'learn-fact':
                    createLearnFact(task);
                    break;
                case 'reasoning-quiz':
                    createReasoningQuiz(task);
                    break;
                case 'scenario-quiz': // NEW
                    createScenarioQuiz(task);
                    break;
                case 'riddle': // NEW
                    createRiddle(task);
                    break;
            }
            
            // Show task container
            elements.taskContainer.classList.add('visible');
        }

        // Create brain teaser task
        function createBrainTeaser(task) {
            const container = document.createElement('div');
            container.className = 'brain-teaser';
            
            const question = document.createElement('div');
            question.className = 'teaser-question';
            question.textContent = task.question;
            container.appendChild(question);
            
            const options = document.createElement('div');
            options.className = 'teaser-options';
            
            task.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'teaser-option';
                optionElement.textContent = option;
                
                optionElement.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.teaser-option').forEach(el => {
                        el.classList.remove('selected');
                    });
            
                    // Add selected class to clicked option
                    optionElement.classList.add('selected');
                    
                    // Store selected answer
                    gameState.currentTask.selectedAnswer = index;
                    
                    // Show submit button
                    elements.taskSubmit.classList.remove('hidden');
                });
                
                options.appendChild(optionElement);
            });
            
            container.appendChild(options);
            elements.taskContent.appendChild(container);
        }

        // Create memory game task (fixed 3x3 grid with 4 pairs)
        function createMemoryGame(task) {
            const container = document.createElement('div');
            container.className = 'memory-game';
            
            const instruction = document.createElement('div');
            instruction.className = 'challenge-instruction';
            instruction.textContent = "Match the pairs to strengthen your memory!";
            // Countdown timer
            let countdown = 2;
            const countdownInterval = setInterval(() => {
                instruction.textContent = `Memorize the cards! Starting in ${countdown}...`;
                countdown--;
                if (countdown < 0) {
                    clearInterval(countdownInterval);
                
                    instruction.textContent = "Match the pairs to strengthen your memory!";
                }
            }, 1000);
            container.appendChild(instruction);
            
            // Select 4 pairs for the 3x3 grid (8 cards + 1 unmatched card)
            const selectedPairs = task.pairs.slice(0, 4);
            // Create cards array with pairs and one extra card
            const cards = [...selectedPairs, ...selectedPairs, task.pairs[4]];
            shuffleArray(cards);
            
            const board = document.createElement('div');
            board.className = 'memory-board';
            
            // Track flipped cards
            let flippedCards = [];
            let matchedPairs = 0;
            
            cards.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.index = index;
                card.dataset.symbol = symbol;
                
                // Initially show all cards
                card.classList.add('flipped');
                card.textContent = symbol;
                
                board.appendChild(card);
            });
            container.appendChild(board);
            elements.taskContent.appendChild(container);
            
            // After 2 seconds, flip all cards back and start the game
            setTimeout(() => {
                const allCards = board.querySelectorAll('.memory-card');
                
                allCards.forEach(card => {
                    card.classList.remove('flipped');
                    card.textContent = '';
                    
                    // Now add the click event listener
                    card.addEventListener('click', () => {
                        // Don't allow flipping if already flipped or matched
                        if (card.classList.contains('flipped') || 
                            card.classList.contains('matched') ||
                            flippedCards.length >= 2) {
                            return;
                        }
                        
                        // Flip the card
                        card.classList.add('flipped');
                        card.textContent = card.dataset.symbol;
                        flippedCards.push(card);
                        // Check for match when two cards are flipped
                        if (flippedCards.length === 2) {
                            if (flippedCards[0].dataset.symbol === flippedCards[1].dataset.symbol) {
                                // Match found
                                flippedCards.forEach(c => {
                                    c.classList.add('matched');
                                    c.classList.remove('flipped');
                                });
                                matchedPairs++;
                                
                                // Clear flipped cards array
                                flippedCards = [];
                                // Check if all pairs are matched
                                if (matchedPairs === selectedPairs.length) {
                                    gameState.currentTask.completed = true;
                                    // Auto-submit when all pairs are matched
                                    setTimeout(() => {
                                        checkTaskAnswer();
                                    }, 500);
                                }
                            } else {
                                // No match - flip back after delay
                                setTimeout(() => {
                                    flippedCards.forEach(c => {
                                        c.classList.remove('flipped');
                                        c.textContent = '';
                                    });
                                    flippedCards = [];
                                }, 1000);
                            }
                        }
                    });
                });
            }, 2000);
        }

        // Create word arrangement task (more concise UI)
        function createWordArrangement(task) {
            const container = document.createElement('div');
            container.className = 'word-arrangement';
            
            const instruction = document.createElement('div');
            instruction.className = 'word-arrangement-instruction';
            instruction.textContent = task.instruction;
            container.appendChild(instruction);
            
            const grid = document.createElement('div');
            grid.className = 'word-grid';
            
            // Shuffle the words
            const shuffledWords = [...task.words];
            shuffleArray(shuffledWords);
            
            let selectedWords = [];
            
            shuffledWords.forEach(word => {
                const tile = document.createElement('div');
                tile.className = 'word-tile';
                tile.textContent = word;
                
                tile.addEventListener('click', () => {
                    if (!tile.classList.contains('selected')) {
                        tile.classList.add('selected');
                        selectedWords.push(word);
                        
                        // Check if all words are selected
                        if (selectedWords.length === task.words.length) {
                            // Check if order is correct
                            let correct = true;
                            for (let i = 0; i < selectedWords.length; i++) {
                                if (selectedWords[i] !== task.correctOrder[i]) {
                                    correct = false;
                                    break;
                                }
                            }
                            
                            if (correct) {
                                gameState.currentTask.completed = true;
                                elements.taskSubmit.classList.remove('hidden');
                            } else {
                                // Show error and reset
                                const errorMsg = document.createElement('div');
                                errorMsg.style.color = 'var(--danger)';
                                errorMsg.style.marginTop = '15px';
                                errorMsg.textContent = 'Not quite right! Try again!';
                                container.appendChild(errorMsg);
                                // Reset after delay
                                setTimeout(() => {
                                    grid.querySelectorAll('.word-tile').forEach(t => {
                                        t.classList.remove('selected');
                                    });
                                    selectedWords = [];
                                    errorMsg.remove();
                                }, 1500);
                            }
                        }
                    }
                });
                grid.appendChild(tile);
            });
            
            container.appendChild(grid);
            elements.taskContent.appendChild(container);
        }

        // Create reasoning quiz task
        function createReasoningQuiz(task) {
            const container = document.createElement('div');
            container.className = 'reasoning-quiz';
            
            let currentQuestion = 0;
            let score = 0;
            function showQuestion(index) {
                container.innerHTML = '';
                const question = task.questions[index];
                
                const questionElement = document.createElement('div');
                questionElement.className = 'teaser-question';
                questionElement.textContent = question.question;
                container.appendChild(questionElement);
                
                const options = document.createElement('div');
                options.className = 'teaser-options';
                
                question.options.forEach((option, i) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'teaser-option';
                    optionElement.textContent = option;
                    
                    optionElement.addEventListener('click', () => {
                        if (i === question.correctAnswer) {
                            score++;
                            
                            optionElement.style.backgroundColor = 'var(--success)';
                        } else {
                            optionElement.style.backgroundColor = 'var(--danger)';
                            document.querySelectorAll('.teaser-option')[question.correctAnswer].style.backgroundColor = 'var(--success)';
                        }
                        
                        setTimeout(() => {
                            if (currentQuestion < task.questions.length - 1) {
                                currentQuestion++;
                                showQuestion(currentQuestion);
                            } else {
                                // Quiz completed
                                gameState.currentTask.completed = true;
                                elements.taskSubmit.classList.remove('hidden');
                                
                                container.innerHTML = `
                                    <div style="text-align: center;">
                                        <h3 style="color: var(--success);">Quiz Complete!</h3>
                                        <p>You scored ${score}/${task.questions.length}</p>
                                        <p>${score === task.questions.length ? "Perfect score! üéâ" : "Good job!"}</p>
                                    </div>
                                `;
                            }
                        }, 1000);
                    });
                    
                    options.appendChild(optionElement);
                });
                
                container.appendChild(options);
            }
            
            showQuestion(0);
            elements.taskContent.appendChild(container);
        }

        // Create learn a fact task
        function createLearnFact(task) {
            const container = document.createElement('div');
            container.className = 'learn-fact';
            
            const fact = document.createElement('div');
            fact.className = 'fact-content';
            fact.textContent = task.fact;
            container.appendChild(fact);
            
            const question = document.createElement('div');
            question.className = 'fact-question';
            question.textContent = task.question;
            container.appendChild(question);
            
            const options = document.createElement('div');
            options.className = 'fact-options';
            task.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'fact-option';
                optionElement.textContent = option;
                
                optionElement.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.fact-option').forEach(el => {
                        el.classList.remove('selected');
                    });
                
                    // Add selected class to clicked option
                    optionElement.classList.add('selected');
                    
                    // Store selected answer
                    gameState.currentTask.selectedAnswer = index;
                    
                    // Show submit button
                    elements.taskSubmit.classList.remove('hidden');
                });
                
                options.appendChild(optionElement);
            });
            
            container.appendChild(options);
            elements.taskContent.appendChild(container);
        }

        // NEW: Create scenario quiz task (Values + Ethics)
        function createScenarioQuiz(task) {
            const container = document.createElement('div');
            container.className = 'scenario-quiz';
            
            const scenario = document.createElement('div');
            scenario.className = 'scenario-text';
            scenario.textContent = task.question;
            container.appendChild(scenario);
            
            const options = document.createElement('div');
            options.className = 'scenario-options';
            
            task.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'scenario-option';
                optionElement.textContent = option;
                
                optionElement.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.scenario-option').forEach(el => {
                        el.classList.remove('selected');
                    });
            
                    // Add selected class to clicked option
                    optionElement.classList.add('selected');
                    
                    // Store selected answer
                    gameState.currentTask.selectedAnswer = index;
                    
                    // Show submit button
                    elements.taskSubmit.classList.remove('hidden');
                });
                
                options.appendChild(optionElement);
            });
            
            container.appendChild(options);
            elements.taskContent.appendChild(container);
        }

        // NEW: Create riddle task (Critical Thinking)
        function createRiddle(task) {
            const container = document.createElement('div');
            container.className = 'riddle';
            
            const riddle = document.createElement('div');
            riddle.className = 'riddle-text';
            riddle.textContent = task.question;
            container.appendChild(riddle);
            
            const options = document.createElement('div');
            options.className = 'riddle-options';
            
            task.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'riddle-option';
                optionElement.textContent = option;
                
                optionElement.addEventListener('click', () => {
                    // Remove selected class from all options
                    document.querySelectorAll('.riddle-option').forEach(el => {
                        el.classList.remove('selected');
                    });
            
                    // Add selected class to clicked option
                    optionElement.classList.add('selected');
                    
                    // Store selected answer
                    gameState.currentTask.selectedAnswer = index;
                    
                    // Show submit button
                    elements.taskSubmit.classList.remove('hidden');
                });
                
                options.appendChild(optionElement);
            });
            
            container.appendChild(options);
            elements.taskContent.appendChild(container);
        }

        // Check task answer
        function checkTaskAnswer() {
            const task = gameState.currentTask;
            let isCorrect = false;
            
            // Check answer based on task type
            switch (task.type) {
                case 'brain-teaser':
                case 'learn-fact':
                case 'scenario-quiz': // NEW
                case 'riddle': // NEW
                    isCorrect = (task.selectedAnswer === task.correctAnswer);
                    break;
                case 'memory-game':
                case 'word-arrangement':
                case 'reasoning-quiz':
                    isCorrect = task.completed;
                    break;
            }
            
            if (isCorrect) {
                elements.taskSubmit.classList.add('hidden');
                // Add XP
                addXP(task.xp);
                // Mark task as completed
                gameState.completedTasks.push(task.id);
                gameState.taskCompleted = true;
                
                // Show success message
                elements.taskContent.innerHTML = `
                    <div style="text-align: center;">
                        <h3 style="color: var(--success);">GREAT JOB! üéâ</h3>
                        <p>You earned ${task.xp} XP!</p>
                        <p>Your learning power increased by ${Math.floor(task.xp/2)}%!</p>
                        <button class="option-btn" style="margin-top: 20px;" id="next-task-btn">Next Challenge</button>
                    </div>
                `;
                // Add confetti effect
                createConfetti();
                // Show power up effect
                showPowerUpEffect();
                // Set up next task button
                document.getElementById('next-task-btn').addEventListener('click', () => {
                    elements.taskContainer.classList.remove('visible');
                    showTask(gameState.completedTasks.length);
                });
                // Check for achievements
                checkAchievements();
            } else {
                // Show try again message
                const errorMsg = document.createElement('div');
                errorMsg.style.textAlign = "center";
                errorMsg.style.marginTop = "20px";
                errorMsg.style.color = "var(--danger)";
                errorMsg.innerHTML = `
                    <p>Not quite right! Try again - you can do it!</p>
                    <p>Remember: Mistakes help us learn!</p>
                `;
                elements.taskContent.appendChild(errorMsg);
            }
        }

        // Show final message
        function showFinalMessage() {
            elements.taskSubmit.classList.add('hidden');
            elements.taskHeader.textContent = "LEARNING COMPLETE!";
            elements.taskContent.innerHTML = `
                <div style="text-align: center;">
                    <h3 style="color: var(--success);">You're becoming a learning superstar!</h3>
                    <p style="font-size: 1.2em; margin: 20px 0;">Your skills improved by ${Math.floor(gameState.xp/6)}%!</p>
                    <p>Keep playing to unlock more learning adventures!</p>
                    <button class="option-btn" style="margin-top: 20px;" id="restart-btn">Play Again</button>
                    <button class="option-btn" style="margin-top: 10px; background: var(--space-purple);" id="chizel-promo-btn">More in CHIZEL App</button>
                </div>
            `;
            elements.taskContainer.classList.add('visible');
            
            // Add confetti effect
            createConfetti();
            // Set up restart button to call the new resetGame function
            document.getElementById('restart-btn').addEventListener('click', resetGame);
            
            // Set up Chizel promo button
            document.getElementById('chizel-promo-btn').addEventListener('click', () => {
                toggleChizelPromo(true);
            });
        }

        // Add XP
        function addXP(amount) {
            gameState.xp += amount;
            updateXPBar();
            checkLevelUp();
            // We can remove saving to localStorage if progress should never persist
            // localStorage.setItem('chizelXP', gameState.xp.toString()); 
        }

        // Update XP bar
        function updateXPBar() {
            const neededXP = gameState.level * 100;
            const progressPercentage = Math.min(100, (gameState.xp / neededXP) * 100);
            
            if(elements.xpProgress) {
                elements.xpProgress.style.width = `${progressPercentage}%`;
            }
            if(elements.xpText) {
                elements.xpText.textContent = `${gameState.xp}/${neededXP} XP`;
            }
            if(elements.levelProgress) {
                elements.levelProgress.style.width = `${progressPercentage}%`;
            }
        }

        // Check for level up
        function checkLevelUp() {
            const neededXP = gameState.level * 100;
            if (gameState.xp >= neededXP) {
                gameState.level++;
                updateLevel();
                showAchievement(`Level ${gameState.level} Unlocked!`, "‚¨ÜüèéÔ∏è");
            }
        }

        // Update level display
        function updateLevel() {
            elements.levelValue.textContent = gameState.level;
            elements.mobileLevelValue.textContent = gameState.level; // NEW
            updateXPBar();
             // We can remove saving to localStorage if progress should never persist
            // localStorage.setItem('chizelLevel', gameState.level.toString());
        }

        // Create confetti effect
        function createConfetti() {
            const colors = ['#4A90E2', '#50E3C2', '#F8E71C', '#FF10F0', '#39FF14'];
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 10 + 5}px`;
                confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                
                document.body.appendChild(confetti);
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // Show power up effect
        function showPowerUpEffect() {
            elements.powerUpEffect.style.opacity = '1';
            setTimeout(() => {
                elements.powerUpEffect.style.opacity = '0';
            }, 2000);
        }

        // Show achievement
        function showAchievement(title, icon) {
            elements.achievementBadge.querySelector('.badge-title').textContent = title;
            elements.achievementBadge.querySelector('.badge-icon').textContent = icon;
            
            elements.achievementBadge.classList.add('visible');
            
            // Close button
            elements.achievementBadge.querySelector('.badge-close').addEventListener('click', () => {
                elements.achievementBadge.classList.remove('visible');
            }, { once: true });
        }

        // Check for unlocked achievements
        function checkAchievements() {
            // Quick Learner achievement (complete 3 tasks)
            if (gameState.completedTasks.length >= 3 && 
                !gameState.achievements.includes('quick-learner')) {
                gameState.achievements.push('quick-learner');
                // localStorage.setItem('chizelAchievements', JSON.stringify(gameState.achievements));
                showAchievement("Quick Learner", "üèéÔ∏è");
                addXP(20);
            }
            
            // Math Whiz achievement
            const mathTasksCompleted = gameState.completedTasks.filter(id => 
                id === 'brain-teaser' || id === 'math-puzzle').length;
            if (mathTasksCompleted >= 3 && 
                !gameState.achievements.includes('math-whiz')) {
                gameState.achievements.push('math-whiz');
                // localStorage.setItem('chizelAchievements', JSON.stringify(gameState.achievements));
                showAchievement("Math Whiz", "‚ûï");
                addXP(50);
            }
            
            // Word Wizard achievement
            const wordTasksCompleted = gameState.completedTasks.filter(id => 
                id === 'word-arrangement').length;
            if (wordTasksCompleted >= 3 && 
                !gameState.achievements.includes('word-wizard')) {
                gameState.achievements.push('word-wizard');
                // localStorage.setItem('chizelAchievements', JSON.stringify(gameState.achievements));
                showAchievement("Word Wizard", "üî†");
                addXP(50);
            }
            
            // NEW: Values Champion achievement
            const valuesTasksCompleted = gameState.completedTasks.filter(id => 
                id === 'values-task').length;
            if (valuesTasksCompleted >= 1 && 
                !gameState.achievements.includes('values-champion')) {
                gameState.achievements.push('values-champion');
                // localStorage.setItem('chizelAchievements', JSON.stringify(gameState.achievements));
                showAchievement("Values Champion", "‚ù§Ô∏è");
                addXP(60);
            }
            
            // NEW: Ethics Guardian achievement
            const ethicsTasksCompleted = gameState.completedTasks.filter(id => 
                id === 'ethics-task').length;
            if (ethicsTasksCompleted >= 1 && 
                !gameState.achievements.includes('ethics-guardian')) {
                gameState.achievements.push('ethics-guardian');
                // localStorage.setItem('chizelAchievements', JSON.stringify(gameState.achievements));
                showAchievement("Ethics Guardian", "‚öñÔ∏è");
                addXP(70);
            }
            
            // NEW: Critical Thinker achievement
            const criticalThinkingTasksCompleted = gameState.completedTasks.filter(id => 
                id === 'critical-thinking-task').length;
            if (criticalThinkingTasksCompleted >= 1 && 
                !gameState.achievements.includes('critical-thinker')) {
                gameState.achievements.push('critical-thinker');
                // localStorage.setItem('chizelAchievements', JSON.stringify(gameState.achievements));
                showAchievement("Critical Thinker", "üîç");
                addXP(80);
            }
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize the game when DOM is loaded
        document.addEventListener('DOMContentLoaded', initGame);

      
    </script>
</body>
</html>